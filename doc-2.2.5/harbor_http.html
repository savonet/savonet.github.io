<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/png" href="/assets/img/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Liquidsoap</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
    <!-- Extra details for Live View on GitHub Pages -->
    <!-- Canonical SEO -->
    <link rel="canonical" href="https://www.liquidsoap.info/" />
    <!--  Social tags      -->
    <meta name="keywords" content="radio, audio, video, streaming, icecast, shoutcast">
    <meta name="description" content="Swiss-army knife for multimedia streaming">
    <!-- Schema.org markup for Google+ -->
    <meta itemprop="name" content="Liquidsoap Streaming Language">
    <meta itemprop="description" content="Swiss-army knife for multimedia streaming">
    <!-- Twitter Card data -->
    <meta name="twitter:card" content="product">
    <meta name="twitter:site" content="@LiquidsoapMedia">
    <meta name="twitter:title" content="Liquidsoap Streaming Language">
    <meta name="twitter:description" content="Swiss-army knife for multimedia streaming">
    <meta name="twitter:creator" content="@LiquidsoapMedia">
    <meta name="twitter:image" content="https://www.liquidsoap.info//assets/img/bottle_invert.png">
    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
    <!-- CSS Files -->
    <link href="/assets/css/custom.css" rel="stylesheet" />
    <link href="/assets/css/material-kit.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
    <!-- Documentation extras -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
    <link rel="stylesheet" href="/assets/demo/docs.min.css">
    <style>
    .navbar-absolute-logo {
      padding-left: 45px;
    }

    .navbar-absolute-logo img {
      position: absolute;
      left: 15px;
      margin-top: -6px;
    }

    body {
      background: white;
    }

    p {
        font-size: 16px;
        text-align: justify;
    }
    </style>
    <style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    </style>
  </head>

  <body class="bd-docs" data-spy="scroll" data-target=".bd-sidenav-active">
    <a id="skippy" class="sr-only sr-only-focusable" href="#content">
      <div class="container">
        <span class="skiplink-text">Skip to main content</span>
      </div>
    </a>
    <header class="navbar navbar-expand navbar-dark bg-primary flex-column flex-md-row bd-navbar">
      <a class="navbar-brand mr-0 mr-md-2 navbar-absolute-logo" href="/doc-2.2.5">
        <svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 600 600" focusable="false" style="width: 25px; height: 25px;">
          <title>Liquidsoap</title>
          <style type="text/css">
.st0{fill:#FFFFFF;}
          </style>
          <g>
          <path class="st0" d="M102.4,593.8c-0.7-2.8-3.4-2.5-5.3-3.3c-24.6-10.2-37.2-28.7-37.2-55.6c-0.1-72.1,0-144.2,0-216.3
          c0-52.3,0-104.6,0-156.9c0-37.6,23.1-60.9,60.6-61.1c12-0.1,23.9-0.2,35.9,0c15.7,0.3,26.7,10.1,26.3,23
          c-0.4,12.5-11.1,21.5-26.3,21.8c-12,0.2-23.9-0.1-35.9,0.1c-11.8,0.1-15.6,3.7-15.6,15.3c-0.1,124.4,0,248.8-0.1,373.2
          c0,10.3,4.5,15.1,14.8,15.1c69.1-0.1,138.2,0,207.3-0.1c12.3,0,15.5-3.7,15.5-17.7c0-74.7,0-149.4,0-224.2c0-47.8,0-95.6,0-143.5
          c0-15.2-3-18.1-18.4-18.2c-10.8,0-21.7,0.1-32.5,0c-16-0.2-26.7-9.4-26.6-22.5c0.1-13,10.9-22.1,26.9-22.3
          c13.4-0.2,26.9-0.3,40.3,0.1c30.8,1,54.9,24.5,55,55.2c0.3,127.4,0.3,254.8,0.1,382.2c0,25.5-15.8,45.7-40.2,53.3
          c-1.7,0.5-3.8,0-4.5,2.4C262.3,593.8,182.4,593.8,102.4,593.8z"/>
          <path class="st0" d="M537.4,212.6c-16.8,23-56.5,16.5-68.6-9.5c-8-17.2-12.4-32.7-12-54.5c4.6,4.1,8.3,7.5,12.1,10.7
          c10.3,8.6,21,14,35.5,11.8c12.5-1.9,21.5,6,28.2,16.3c2,3,1.3,7.3,4.8,9.5C537.4,202.2,537.4,207.4,537.4,212.6z"/>
          <path class="st0" d="M200.6,230.4c0-55.3,0-110.5,0-165.8c0-40.7,22.3-62.7,63.2-62.7c50.4,0,100.8,0,151.3,0
          c36.1,0,59.1,21.9,60.4,57.7c0.5,13.1,0.4,26.1,0,39.2c-0.4,15.1-10.1,25.8-22.5,25.7c-12-0.1-21.6-10.1-22.3-24.8
          c-0.6-12.7-0.4-25.4-0.1-38.1c0.2-10.4-4.5-14.9-14.9-14.9c-51.5,0.1-103.1,0-154.6,0.1c-12.7,0-15.5,3.2-15.5,17.5
          c0,105.3,0,210.6,0,316c0,7.8,0.1,15.7,0,23.5c-0.2,17.5-9.4,28.9-23,28.6c-13.5-0.3-21.9-10.9-21.9-28.3
          C200.6,346.2,200.6,288.3,200.6,230.4z"/>
          </g>
        </svg>
        Liquidsoap
      </a>
      <ul class="navbar-nav flex-row d-none d-md-flex">
        <li class="nav-item dropdown">
          <a data-versions="dev 2.2.5 2.3.0 2.3.1 2.3.2 2.3.3
2.4.0" data-version="2.2.5" class="nav-item nav-link dropdown-toggle mr-md-2" href="#" id="liq-version" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            2.2.5
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="liq-version" id="liq-versions">
          </div>
        </li>
        <li class="nav-item">
          <a class="nav-link p-2" href="https://github.com/savonet/liquidsoap" target="_blank" rel="noopener" aria-label="GitHub">
            <svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 499.36" focusable="false">
              <title>GitHub</title>
              <path d="M256 0C114.64 0 0 114.61 0 256c0 113.09 73.34 209 175.08 242.9 12.8 2.35 17.47-5.56 17.47-12.34 0-6.08-.22-22.18-.35-43.54-71.2 15.49-86.2-34.34-86.2-34.34-11.64-29.57-28.42-37.45-28.42-37.45-23.27-15.84 1.73-15.55 1.73-15.55 25.69 1.81 39.21 26.38 39.21 26.38 22.84 39.12 59.92 27.82 74.5 21.27 2.33-16.54 8.94-27.82 16.25-34.22-56.84-6.43-116.6-28.43-116.6-126.49 0-27.95 10-50.8 26.35-68.69-2.63-6.48-11.42-32.5 2.51-67.75 0 0 21.49-6.88 70.4 26.24a242.65 242.65 0 0 1 128.18 0c48.87-33.13 70.33-26.24 70.33-26.24 14 35.25 5.18 61.27 2.55 67.75 16.41 17.9 26.31 40.75 26.31 68.69 0 98.35-59.85 120-116.88 126.32 9.19 7.9 17.38 23.53 17.38 47.41 0 34.22-.31 61.83-.31 70.23 0 6.85 4.61 14.81 17.6 12.31C438.72 464.97 512 369.08 512 256.02 512 114.62 397.37 0 256 0z" fill="currentColor" fill-rule="evenodd" />
            </svg>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link p-2" href="https://twitter.com/liquidsoapmedia" target="_blank" rel="noopener" aria-label="Twitter">
            <svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 416.32" focusable="false">
              <title>Twitter</title>
              <path d="M160.83 416.32c193.2 0 298.92-160.22 298.92-298.92 0-4.51 0-9-.2-13.52A214 214 0 0 0 512 49.38a212.93 212.93 0 0 1-60.44 16.6 105.7 105.7 0 0 0 46.3-58.19 209 209 0 0 1-66.79 25.37 105.09 105.09 0 0 0-181.73 71.91 116.12 116.12 0 0 0 2.66 24c-87.28-4.3-164.73-46.3-216.56-109.82A105.48 105.48 0 0 0 68 159.6a106.27 106.27 0 0 1-47.53-13.11v1.43a105.28 105.28 0 0 0 84.21 103.06 105.67 105.67 0 0 1-47.33 1.84 105.06 105.06 0 0 0 98.14 72.94A210.72 210.72 0 0 1 25 370.84a202.17 202.17 0 0 1-25-1.43 298.85 298.85 0 0 0 160.83 46.92" fill="currentColor" />
            </svg>
          </a>
        </li>
      </ul>
      <div class="navbar-nav-scroll ml-md-auto ">
        <ul class="navbar-nav bd-navbar-nav flex-row">
          <!--
            <li class="nav-item">
            <a class="nav-link" href=""> <i class="material-icons">card_membership</i> PRO Services </a>
            </li>
            -->
          <li class="nav-item">
            <script async src="https://cse.google.com/cse.js?cx=24f50f6f088994c53"></script>
            <style>
.cse .gsc-control-cse, .gsc-control-cse {
  background-color: transparent;
  border: none;
  width: 300px;
}
            </style>
            <div class="gcse-search"></div>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/savonet/liquidsoap/issues" target="_blank" rel="noopener"><i class="material-icons">star</i> Get Help</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="" target="_blank" rel="noopener"></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="" target="_blank" rel="noopener"></a>
          </li>
        </ul>
      </div>
      <a href="https://github.com/savonet/liquidsoap" class="github-corner" aria-label="View source on Github">
        <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#fff; color:#9c27b0; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
          <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
          <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
          <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
        </svg>
      </a>
      <style>
.github-corner:hover .octo-arm {
  animation: octocat-wave 560ms ease-in-out
}

        @keyframes octocat-wave {
          0%,
          100% {
            transform: rotate(0)
          }
          20%,
          60% {
            transform: rotate(-25deg)
          }
          40%,
          80% {
            transform: rotate(10deg)
          }
        }

        @media (max-width:500px) {
          .github-corner:hover .octo-arm {
            animation: none
          }
          .github-corner .octo-arm {
            animation: octocat-wave 560ms ease-in-out
          }
        }
      </style>
    </header>
    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 bd-sidebar">
          <nav class="collapse bd-links" id="bd-docs-nav">
            <div class="bd-toc-item active">
              <ul class="nav bd-sidenav">
                <li class="active bd-sidenav-active">
                  <a class="bd-toc-link" href="/doc-2.2.5/install.html">
                    Install
                  </a>
                </li>
                <li>
                  <a href="/doc-2.2.5/migrating.html">
                    Migrating from previous versions
                  </a>
                </li>
                <li class="active bd-sidenav-active">
                  <a class="bd-toc-link" href="#">
                    Starters
                  </a>
                </li>
                <li><a href="/doc-2.2.5/book.html">The book</a></li>
                <li>
                  <a href="/doc-2.2.5/presentations.html">Video Presentations</a>
                </li>
                <li>
                  <a href="/doc-2.2.5/help.html">How to find help</a>
                </li>
                <li>
                  <a href="/doc-2.2.5/faq.html">Frequently Asked Questions</a>
                </li>
                <li><a href="/doc-2.2.5/quick_start.html">Quickstart</a></li>
                <li>
                  <a href="/doc-2.2.5/complete_case.html">Complete case analysis</a>
                </li>
                <li>
                  <a href="/doc-2.2.5/cookbook.html">Cookbook</a>
                </li>
              </ul>
            </div>
            <div class="bd-toc-item active">
              <a class="bd-toc-link" href="#">
                Reference
              </a>
              <ul class="nav bd-sidenav">
                <li>
                  <a href="/doc-2.2.5/language.html">Script language</a></li>
                <li>
                  <a href="/doc-2.2.5/reference.html">Core API</a></li>
                <li>
                  <a href="/doc-2.2.5/reference-extras.html">Extra API</a></li>
                <li>
                  <a href="/doc-2.2.5/reference-deprecated.html">Deprecated API</a></li>
                <li>
                  <a href="/doc-2.2.5/multitrack.html">Multitrack</a></li>
                <li>
                  <a href="/doc-2.2.5/protocols.html">Protocols</a></li>
                <li>
                  <a href="/doc-2.2.5/settings.html">Settings</a></li>
                <li>
                  <a href="/doc-2.2.5/ffmpeg.html">FFmpeg support</a></li>
                <li>
                  <a href="/doc-2.2.5/encoding_formats.html">Encoding formats</a></li>
                <li>
                  <a href="/doc-2.2.5/video.html">Videos streams</a></li>
                <li>
                  <a href="/doc-2.2.5/memory.html">Memory management</a></li>
                <li>
                  <a href="/doc-2.2.5/json.html">JSON import/export</a></li>
                <li>
                  <a href="/doc-2.2.5/yaml.html">YAML import/export</a></li>
                <li>
                  <a href="/doc-2.2.5/ladspa.html">LADSPA plugins</a></li>
                <li>
                  <a href="/doc-2.2.5/playlist_parsers.html">Playlist parsers</a></li>
              </ul>
            </div>
            <div class="bd-toc-item active">
              <a class="bd-toc-link" href="#">
                Core
              </a>
              <ul class="nav bd-sidenav">
                <li>
                  <a href="/doc-2.2.5/sources.html">Sources</a></li>
                <li>
                  <a href="/doc-2.2.5/clocks.html">Clocks</a></li>
                <li>
                  <a href="/doc-2.2.5/requests.html">Requests</a></li>
                <li>
                  <a href="/doc-2.2.5/protocols-presentation.html">Protocols</a></li>
                <li>
                  <a href="/doc-2.2.5/stream_content.html">Stream contents</a></li>
                <li>
                  <a href="/doc-2.2.5/strings_encoding.html">Strings encoding</a></li>
                <li>
                  <a href="/doc-2.2.5/script_loading.html">Script loading</a></li>
                <li><a href="/doc-2.2.5/phases.html">Execution phases</a></li>
              </ul>
            </div>
            <div class="bd-toc-item active">
              <a class="bd-toc-link" href="#">
                Specific tutorials
              </a>
              <ul class="nav bd-sidenav">
                <li>
                  <a href="/doc-2.2.5/harbor_http.html">Using the HTTP server</a></li>
                <li>
                  <a href="/doc-2.2.5/blank.html">Blank detection</a></li>
                <li>
                  <a href="/doc-2.2.5/metadata.html">Customize metadata</a></li>
                <li>
                  <a href="/doc-2.2.5/seek.html">Seek and cue support</a></li>
                <li>
                  <a href="/doc-2.2.5/external_decoders.html">External decoders</a></li>
                <li>
                  <a href="/doc-2.2.5/external_streams.html">External streams</a></li>
                <li>
                  <a href="/doc-2.2.5/external_encoders.html">External encoders</a></li>
                <li>
                  <a href="/doc-2.2.5/hls_output.html">HLS output</a></li>
                <li>
                  <a href="/doc-2.2.5/http_input.html">HTTP input</a></li>
                <li>
                  <a href="/doc-2.2.5/harbor.html">Harbor input</a></li>
                <li>
                  <a href="/doc-2.2.5/stereotool.html">Stereotool</a></li>
                <li>
                  <a href="/doc-2.2.5/server.html">Using the telnet server</a></li>
                <li>
                  <a href="/doc-2.2.5/icy_metadata.html">ICY metadata update</a></li>
                <li>
                  <a href="/doc-2.2.5/replay_gain.html">Normalization and replay gain</a></li>
                <li>
                  <a href="/doc-2.2.5/request_sources.html">Requests-based sources</a></li>
                <li>
                  <a href="/doc-2.2.5/shoutcast.html">Shoutcast output</a></li>
                <li>
                  <a href="/doc-2.2.5/dynamic_sources.html">Dynamic source creation</a></li>
                <li>
                  <a href="/doc-2.2.5/crossfade.html">Crossfading</a></li>
                <li>
                  <a href="/doc-2.2.5/in_production.html">Using in production</a></li>
              </ul>
              <ul class="nav bd-sidenav">
                <li>
                  <a class="bd-toc-link" href="#">
                    User scripts
                  </a>
                </li>
                <li>
                  <a href="/doc-2.2.5/beets.html">Beets</a></li>
                <li>
                  <a href="/doc-2.2.5/geekradio.html">Geekradio</a></li>
                <li>
                  <a href="/doc-2.2.5/radiopi.html">RadioPi</a></li>
                <li>
                  <a href="/doc-2.2.5/dolebrai.html">Dolebraï</a></li>
                <li>
                  <a href="/doc-2.2.5/frequence3.html">Frequence3</a></li>
                <li>
                  <a href="/doc-2.2.5/video-static.html">Video with a single static image</a></li>
                <li>
                  <a href="/doc-2.2.5/split-cue.html">Split a CUE sheet</a></li>
              </ul>
              <ul class="nav bd-sidenav">
                <li>
                  <a class="bd-toc-link" href="#">
                    Behind the curtains
                  </a>
                </li>
                <li>
                  <a href="/doc-2.2.5/publications.html">Some presentations and publications</a></li>
                <li>
                  <a href="https://github.com/savonet">OCaml libraries</a></li>
                <li class="active bd-sidenav-active">
                  <a class="bd-toc-link" href="/legacy">
                    Legacy website
                  </a>
                </li>
              </ul>
            </div>
          </nav>
        </div>
        <!--
          <div class="d-none d-xl-block col-xl-2 bd-toc">
          <ul class="section-nav">
          <li class="toc-entry toc-h2">
          <a href="#quick-start">Quick start</a>
          <ul>
          <li class="toc-entry toc-h3">
          <a href="#css">CSS</a>
          </li>
          <li class="toc-entry toc-h3">
          <a href="#js">JS</a>
          </li>
          <li class="toc-entry toc-h3">
          <a href="#fonts-and-icons">Fonts and Icons</a>
          </li>
          </ul>
          </li>
          <li class="toc-entry toc-h2">
          <a href="#starter-template">Starter template</a>
          </li>
          </ul>
          </div>
        -->
          <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content" role="main">
          <h1 id="harbor-as-http-server"><a
href="#harbor-as-http-server" class="anchor">Harbor as HTTP
server</a></h1>
<p>The harbor server can be used as a HTTP server. We provide two type
of APIs for this:</p>
<h2 id="simple-api"><a href="#simple-api" class="anchor">Simple
API</a></h2>
<p>The <code>harbor.http.register.simple</code> function provides a
simple, easy to use registration API for quick HTTP response
implementation. This function receives a record describing the request
and returns the HTTP response.</p>
<p>The request passed to the function contains all expected information
from the underlying HTTP query.</p>
<p>The <code>data</code> method on a request is a <em>string
getter</em>, that is a function of type: <code>() -&gt; string</code>
which returns the empty string <code>""</code> when all data has been
consumed. You can use this function to e.g. write the request data to a
file using <code>file.write.stream</code>.</p>
<p>The <code>body</code> method can be used to read all of the request’s
data and store it in memory. Make sure to only use it if you know that
the response should be small enough!</p>
<p>For convenience, a HTTP response builder is provided via
<code>harbor.http.response</code>. Here’s an example:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="dt">handler</span>(request) =</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">log</span>(<span class="st">&quot;Got a request on path #{request.path}, protocol version: #{request.http_version}, \</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="st">       method: #{request.method}, headers: #{request.headers}, query: #{request.query}, \</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="st">       body: #{request.body()}&quot;</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">harbor.http.response</span>(</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">content_type</span>=<span class="st">&quot;text/html&quot;</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="va">data</span>=<span class="st">&quot;&lt;p&gt;ok, this works!&lt;/p&gt;&quot;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="dt">harbor.http.register.simple</span>(<span class="va">port</span>=<span class="dv">8080</span>, <span class="va">method</span>=<span class="st">&quot;GET&quot;</span>, path, handler)</span></code></pre></div>
<p>where:</p>
<ul>
<li><code>port</code> is the port where to receive incoming
connections</li>
<li><code>method</code> is for the http method (or verb), one of:
<code>"GET"</code>, <code>"PUT"</code>, <code>"POST"</code>,
<code>"DELETE"</code>, <code>"OPTIONS"</code> and
<code>"HEAD"</code></li>
<li><code>path</code> is the matched path. It can include named
fragments, e.g. <code>"/users/:id/collabs/:cid"</code>. Named named
fragments are passed via <code>request.query</code>, for instance:
<code>req.query["cid"]</code>.</li>
</ul>
<h2 id="nodeexpress-api"><a href="#nodeexpress-api"
class="anchor">Node/express API</a></h2>
<p>The <code>harbor.http.register</code> function offers a higher-level
API for advanced HTTP response implementation. Its API is very similar
to the node/express API. Here’s an example:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="dt">handler</span>(request, response) =</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">log</span>(<span class="st">&quot;Got a request on path #{request.path}, protocol version: #{request.http_version}, \</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="st">       method: #{request.method}, headers: #{request.headers}, query: #{request.query}, \</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="st">       body: #{request.body()}&quot;</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set response code. Defaults to 200</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">response.status_code</span>(<span class="dv">201</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set response status message. Uses `status_code` if not specified</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">response.status_message</span>(<span class="st">&quot;Created&quot;</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Replaces response headers</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">response.headers</span>([<span class="st">&quot;X-Foo&quot;</span>, <span class="st">&quot;bar&quot;</span>])</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set a single header</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">response.header</span>(<span class="st">&quot;X-Foo&quot;</span>, <span class="st">&quot;bar&quot;</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set http protocol version</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">response.http_version</span>(<span class="st">&quot;1.1&quot;</span>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Same as setting the &quot;Content-Type&quot; header</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="dt">response.content_type</span>(<span class="st">&quot;application/liquidsoap&quot;</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set response data. Can be a `string` or a function of type `()-&gt;string` returning an empty string</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># when done such as `file.read`</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">response.data</span>(<span class="st">&quot;foo&quot;</span>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Advanced wrappers:</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sets content-type to json and data to `json.stringify({foo = &quot;bla&quot;})`</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="dt">response.json</span>({<span class="va">foo</span> = <span class="st">&quot;bla&quot;</span>})</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sets `status_code` and `Location:` header for a HTTP redirect response. Takes an optional `status_code` argument.</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  <span class="dt">response.redirect</span>(<span class="st">&quot;http://...&quot;</span>)</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sets content-type to html and data to `&quot;&lt;p&gt;It works!&lt;/p&gt;&quot;`</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="dt">response.html</span>(<span class="st">&quot;&lt;p&gt;It works!&lt;/p&gt;&quot;</span>)</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="dt">harbor.http.register</span>(<span class="va">port</span>=<span class="dv">8080</span>, <span class="va">method</span>=<span class="st">&quot;GET&quot;</span>, path, handler)</span></code></pre></div>
<p>where:</p>
<ul>
<li><code>port</code> is the port where to receive incoming
connections</li>
<li><code>method</code> is for the http method (or verb), one of:
<code>"GET"</code>, <code>"PUT"</code>, <code>"POST"</code>,
<code>"DELETE"</code>, <code>"OPTIONS"</code> and
<code>"HEAD"</code></li>
<li><code>path</code> is the matched path. It can include named
fragments, e.g. <code>"/users/:id/collabs/:cid"</code>. Matched named
fragments are passed via <code>request.query</code>, for instance:
<code>req.query["cid"]</code>.</li>
</ul>
<p>The handler function receives a record containing all the information
about the request and fills up the details about the response, which is
then used to write a proper HTTP response to the client.</p>
<p>Named fragments from the request path are passed to the response
<code>query</code> list.</p>
<p>Middleware <em>a la</em> node/express are also supported and
registered via <code>http.harbor.middleware.register</code>. See
<code>http.harbor.middleware.cors</code> for an example of how to
implement one such middleware.</p>
<p>Here’s how you would enable the <code>cors</code> middleware:</p>
<pre><code>harbor.http.middleware.register(harbor.http.middleware.cors(origin=&quot;example.com&quot;))</code></pre>
<h2 id="https-support"><a href="#https-support" class="anchor">Https
support</a></h2>
<p><code>https</code> is supported using either <code>libssl</code> or
<code>ocaml-tls</code>. When compiled with either of them, a
<code>http.transport.ssl</code> or <code>http.transport.tls</code> is
available and can be passed to each <code>harbor</code> operator:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="va">transport</span> = <span class="dt">http.transport.ssl</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Server mode: required,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># client mode: optional, add certificate to trusted pool</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">certificate</span>=<span class="st">&quot;/path/to/certificate/file&quot;</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Server mode: required, client mode: ignored</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="va">key</span>=<span class="st">&quot;/path/to/secret/key/file&quot;</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Required if key file requires one.</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># TLS does not support password encrypted keys!</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="va">password</span>=<span class="st">&quot;optional password&quot;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="dt">harbor.http.register</span>(<span class="va">transport</span>=transport, <span class="va">port</span>=<span class="dv">8000</span>, ...)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="dt">input.harbor</span>(<span class="va">transport</span>=..., <span class="va">port</span>=<span class="dv">8000</span>, ...)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="dt">output.harbor</span>(<span class="va">transport</span>=..., <span class="va">port</span>=<span class="dv">8000</span>, ...)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="dt">output.icecast</span>(<span class="va">transport</span>=..., <span class="va">port</span>=<span class="dv">8000</span>, ...)</span></code></pre></div>
<p>A given port can only support one type of transport at a time and
registering handlers, sources or outputs on the same port with different
transports will raise a <code>error.http</code> error.</p>
<h2 id="advanced-usage"><a href="#advanced-usage"
class="anchor">Advanced usage</a></h2>
<p>All registration functions have a <code>.regexp</code> counter part,
e.g. <code>harbor.http.register.simple.regexp</code>. These function
accept a full regular expression for their <code>path</code> argument.
Named matches on the regular expression are also passed via the
request’s <code>query</code> parameter.</p>
<p>It is also possible to directly interact with the underlying socket
using the <code>simple</code> API:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Custom response</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="dt">handler</span>(req) =</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">req.socket.write</span>(<span class="st">&quot;HTTP/1.0 201 YYR\r\nFoo: bar\r\n\r\n&quot;</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">req.socket.close</span>()</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Null indicates that we&#39;re using the socket directly.</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">null</span>()</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">harbor.http.register.simple</span>(<span class="st">&quot;/custom&quot;</span>, <span class="va">port</span>=<span class="dv">3456</span>, handler)</span></code></pre></div>
<h2 id="examples"><a href="#examples" class="anchor">Examples</a></h2>
<p>These functions can be used to create your own HTTP interface. Some
examples are:</p>
<h2 id="redirect-icecasts-pages"><a href="#redirect-icecasts-pages"
class="anchor">Redirect Icecast’s pages</a></h2>
<p>Some source clients using the harbor may also request pages that are
served by an icecast server, for instance listeners statistics. In this
case, you can register the following handler:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Redirect all files other</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># than /admin.* to icecast,</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># located at localhost:8000</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="dt">redirect_icecast</span>(request, response) =</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">response.redirect</span>(<span class="st">&quot;http://localhost:8000#{request.path}&quot;</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Register this handler at port 8005</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># (provided harbor sources are also served</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#  from this port).</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="dt">harbor.http.register.regexp</span>(</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="va">port</span>=<span class="dv">8005</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="va">method</span>=<span class="st">&quot;GET&quot;</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  r/^\/(?!admin)/,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  redirect_icecast</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<h2 id="get-metadata"><a href="#get-metadata" class="anchor">Get
metadata</a></h2>
<p>You can use harbor to register HTTP services to fecth/set the
metadata of a source.</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="va">meta</span> = <span class="dt">ref</span>([])</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># s = some source</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="dt">s.on_metadata</span>(<span class="kw">fun</span> (m) -&gt; meta := m)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Return the json content of meta</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="dt">get_meta</span>(_, response) =</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">response.json</span>(!meta)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Register get_meta at port 700</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="dt">harbor.http.register</span>(<span class="va">port</span>=<span class="dv">7000</span>,<span class="va">method</span>=<span class="st">&quot;GET&quot;</span>,<span class="st">&quot;/getmeta&quot;</span>,get_meta)</span></code></pre></div>
<p>Once the script is running, a GET request for <code>/getmeta</code>
at port <code>7000</code> returns the following:</p>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8

{
  &quot;genre&quot;: &quot;Soul&quot;,
  &quot;album&quot;: &quot;The Complete Stax-Volt Singles: 1959-1968 (Disc 8)&quot;,
  &quot;artist&quot;: &quot;Astors&quot;,
  &quot;title&quot;: &quot;Daddy Didn&#39;t Tell Me&quot;
}</code></pre>
<h2 id="set-metadata"><a href="#set-metadata" class="anchor">Set
metadata</a></h2>
<p>Using <code>insert_metadata</code>, you can register a GET handler
that updates the metadata of a given source. For instance:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># s = some source</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a source equipped with a `insert_metadata` method:</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="va">s</span> = <span class="dt">insert_metadata</span>(s)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The handler</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="dt">set_meta</span>(request, response) =</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter out unusual metadata</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="va">meta</span> = <span class="dt">metadata.export</span>(request.query)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Grab the returned message</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="va">ret</span> =</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> meta != [] <span class="kw">then</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>      <span class="dt">s.insert_metadata</span>(meta)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;OK!&quot;</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;No metadata to add!&quot;</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">response.html</span>(<span class="st">&quot;&lt;html&gt;&lt;body&gt;&lt;b&gt;#{ret}&lt;/b&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Register handler on port 700</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="dt">harbor.http.register</span>(<span class="va">port</span>=<span class="dv">7000</span>,<span class="va">method</span>=<span class="st">&quot;GET&quot;</span>,<span class="st">&quot;/setmeta&quot;</span>,set_meta)</span></code></pre></div>
<p>Now, a request of the form
<code>http://server:7000/setmeta?title=foo</code> will update the
metadata of source <code>s</code> with <code>[("title","foo")]</code>.
You can use this handler, for instance, in a custom HTML form.</p>
          <div id="footer"></div>
        </main>
      </div>
    </div>
    <!--   Core JS Files   -->

    <script src="/assets/js/core/jquery.min.js" type="text/javascript"></script>
    <script src="/assets/js/core/popper.min.js" type="text/javascript"></script>
    <script src="/assets/js/core/bootstrap-material-design.min.js" type="text/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript"></script>
    <script src="/assets/js/liq-jquery.js" type="text/javascript"></script>
  </body>

</html>
