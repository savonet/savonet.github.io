<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/png" href="/assets/img/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Liquidsoap</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
    <!-- Extra details for Live View on GitHub Pages -->
    <!-- Canonical SEO -->
    <link rel="canonical" href="https://www.liquidsoap.info/" />
    <!--  Social tags      -->
    <meta name="keywords" content="radio, audio, video, streaming, icecast, shoutcast">
    <meta name="description" content="Swiss-army knife for multimedia streaming">
    <!-- Schema.org markup for Google+ -->
    <meta itemprop="name" content="Liquidsoap Streaming Language">
    <meta itemprop="description" content="Swiss-army knife for multimedia streaming">
    <!-- Twitter Card data -->
    <meta name="twitter:card" content="product">
    <meta name="twitter:site" content="@LiquidsoapMedia">
    <meta name="twitter:title" content="Liquidsoap Streaming Language">
    <meta name="twitter:description" content="Swiss-army knife for multimedia streaming">
    <meta name="twitter:creator" content="@LiquidsoapMedia">
    <meta name="twitter:image" content="https://www.liquidsoap.info//assets/img/bottle_invert.png">
    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
    <!-- CSS Files -->
    <link href="/assets/css/custom.css" rel="stylesheet" />
    <link href="/assets/css/material-kit.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
    <!-- Documentation extras -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
    <link rel="stylesheet" href="/assets/demo/docs.min.css">
    <style>
    .navbar-absolute-logo {
      padding-left: 45px;
    }

    .navbar-absolute-logo img {
      position: absolute;
      left: 15px;
      margin-top: -6px;
    }

    body {
      background: white;
    }

    p {
        font-size: 16px;
        text-align: justify;
    }
    </style>
    <style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    </style>
  </head>

  <body class="bd-docs" data-spy="scroll" data-target=".bd-sidenav-active">
    <a id="skippy" class="sr-only sr-only-focusable" href="#content">
      <div class="container">
        <span class="skiplink-text">Skip to main content</span>
      </div>
    </a>
    <header class="navbar navbar-expand navbar-dark bg-primary flex-column flex-md-row bd-navbar">
      <a class="navbar-brand mr-0 mr-md-2 navbar-absolute-logo" href="/doc-2.2.5">
        <svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 600 600" focusable="false" style="width: 25px; height: 25px;">
          <title>Liquidsoap</title>
          <style type="text/css">
.st0{fill:#FFFFFF;}
          </style>
          <g>
          <path class="st0" d="M102.4,593.8c-0.7-2.8-3.4-2.5-5.3-3.3c-24.6-10.2-37.2-28.7-37.2-55.6c-0.1-72.1,0-144.2,0-216.3
          c0-52.3,0-104.6,0-156.9c0-37.6,23.1-60.9,60.6-61.1c12-0.1,23.9-0.2,35.9,0c15.7,0.3,26.7,10.1,26.3,23
          c-0.4,12.5-11.1,21.5-26.3,21.8c-12,0.2-23.9-0.1-35.9,0.1c-11.8,0.1-15.6,3.7-15.6,15.3c-0.1,124.4,0,248.8-0.1,373.2
          c0,10.3,4.5,15.1,14.8,15.1c69.1-0.1,138.2,0,207.3-0.1c12.3,0,15.5-3.7,15.5-17.7c0-74.7,0-149.4,0-224.2c0-47.8,0-95.6,0-143.5
          c0-15.2-3-18.1-18.4-18.2c-10.8,0-21.7,0.1-32.5,0c-16-0.2-26.7-9.4-26.6-22.5c0.1-13,10.9-22.1,26.9-22.3
          c13.4-0.2,26.9-0.3,40.3,0.1c30.8,1,54.9,24.5,55,55.2c0.3,127.4,0.3,254.8,0.1,382.2c0,25.5-15.8,45.7-40.2,53.3
          c-1.7,0.5-3.8,0-4.5,2.4C262.3,593.8,182.4,593.8,102.4,593.8z"/>
          <path class="st0" d="M537.4,212.6c-16.8,23-56.5,16.5-68.6-9.5c-8-17.2-12.4-32.7-12-54.5c4.6,4.1,8.3,7.5,12.1,10.7
          c10.3,8.6,21,14,35.5,11.8c12.5-1.9,21.5,6,28.2,16.3c2,3,1.3,7.3,4.8,9.5C537.4,202.2,537.4,207.4,537.4,212.6z"/>
          <path class="st0" d="M200.6,230.4c0-55.3,0-110.5,0-165.8c0-40.7,22.3-62.7,63.2-62.7c50.4,0,100.8,0,151.3,0
          c36.1,0,59.1,21.9,60.4,57.7c0.5,13.1,0.4,26.1,0,39.2c-0.4,15.1-10.1,25.8-22.5,25.7c-12-0.1-21.6-10.1-22.3-24.8
          c-0.6-12.7-0.4-25.4-0.1-38.1c0.2-10.4-4.5-14.9-14.9-14.9c-51.5,0.1-103.1,0-154.6,0.1c-12.7,0-15.5,3.2-15.5,17.5
          c0,105.3,0,210.6,0,316c0,7.8,0.1,15.7,0,23.5c-0.2,17.5-9.4,28.9-23,28.6c-13.5-0.3-21.9-10.9-21.9-28.3
          C200.6,346.2,200.6,288.3,200.6,230.4z"/>
          </g>
        </svg>
        Liquidsoap
      </a>
      <ul class="navbar-nav flex-row d-none d-md-flex">
        <li class="nav-item dropdown">
          <a data-versions="dev 2.2.5 2.3.0 2.3.1 2.3.2 2.3.3
2.4.0" data-version="2.2.5" class="nav-item nav-link dropdown-toggle mr-md-2" href="#" id="liq-version" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            2.2.5
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="liq-version" id="liq-versions">
          </div>
        </li>
        <li class="nav-item">
          <a class="nav-link p-2" href="https://github.com/savonet/liquidsoap" target="_blank" rel="noopener" aria-label="GitHub">
            <svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 499.36" focusable="false">
              <title>GitHub</title>
              <path d="M256 0C114.64 0 0 114.61 0 256c0 113.09 73.34 209 175.08 242.9 12.8 2.35 17.47-5.56 17.47-12.34 0-6.08-.22-22.18-.35-43.54-71.2 15.49-86.2-34.34-86.2-34.34-11.64-29.57-28.42-37.45-28.42-37.45-23.27-15.84 1.73-15.55 1.73-15.55 25.69 1.81 39.21 26.38 39.21 26.38 22.84 39.12 59.92 27.82 74.5 21.27 2.33-16.54 8.94-27.82 16.25-34.22-56.84-6.43-116.6-28.43-116.6-126.49 0-27.95 10-50.8 26.35-68.69-2.63-6.48-11.42-32.5 2.51-67.75 0 0 21.49-6.88 70.4 26.24a242.65 242.65 0 0 1 128.18 0c48.87-33.13 70.33-26.24 70.33-26.24 14 35.25 5.18 61.27 2.55 67.75 16.41 17.9 26.31 40.75 26.31 68.69 0 98.35-59.85 120-116.88 126.32 9.19 7.9 17.38 23.53 17.38 47.41 0 34.22-.31 61.83-.31 70.23 0 6.85 4.61 14.81 17.6 12.31C438.72 464.97 512 369.08 512 256.02 512 114.62 397.37 0 256 0z" fill="currentColor" fill-rule="evenodd" />
            </svg>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link p-2" href="https://twitter.com/liquidsoapmedia" target="_blank" rel="noopener" aria-label="Twitter">
            <svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 416.32" focusable="false">
              <title>Twitter</title>
              <path d="M160.83 416.32c193.2 0 298.92-160.22 298.92-298.92 0-4.51 0-9-.2-13.52A214 214 0 0 0 512 49.38a212.93 212.93 0 0 1-60.44 16.6 105.7 105.7 0 0 0 46.3-58.19 209 209 0 0 1-66.79 25.37 105.09 105.09 0 0 0-181.73 71.91 116.12 116.12 0 0 0 2.66 24c-87.28-4.3-164.73-46.3-216.56-109.82A105.48 105.48 0 0 0 68 159.6a106.27 106.27 0 0 1-47.53-13.11v1.43a105.28 105.28 0 0 0 84.21 103.06 105.67 105.67 0 0 1-47.33 1.84 105.06 105.06 0 0 0 98.14 72.94A210.72 210.72 0 0 1 25 370.84a202.17 202.17 0 0 1-25-1.43 298.85 298.85 0 0 0 160.83 46.92" fill="currentColor" />
            </svg>
          </a>
        </li>
      </ul>
      <div class="navbar-nav-scroll ml-md-auto ">
        <ul class="navbar-nav bd-navbar-nav flex-row">
          <!--
            <li class="nav-item">
            <a class="nav-link" href=""> <i class="material-icons">card_membership</i> PRO Services </a>
            </li>
            -->
          <li class="nav-item">
            <script async src="https://cse.google.com/cse.js?cx=24f50f6f088994c53"></script>
            <style>
.cse .gsc-control-cse, .gsc-control-cse {
  background-color: transparent;
  border: none;
  width: 300px;
}
            </style>
            <div class="gcse-search"></div>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/savonet/liquidsoap/issues" target="_blank" rel="noopener"><i class="material-icons">star</i> Get Help</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="" target="_blank" rel="noopener"></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="" target="_blank" rel="noopener"></a>
          </li>
        </ul>
      </div>
      <a href="https://github.com/savonet/liquidsoap" class="github-corner" aria-label="View source on Github">
        <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#fff; color:#9c27b0; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
          <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
          <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
          <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
        </svg>
      </a>
      <style>
.github-corner:hover .octo-arm {
  animation: octocat-wave 560ms ease-in-out
}

        @keyframes octocat-wave {
          0%,
          100% {
            transform: rotate(0)
          }
          20%,
          60% {
            transform: rotate(-25deg)
          }
          40%,
          80% {
            transform: rotate(10deg)
          }
        }

        @media (max-width:500px) {
          .github-corner:hover .octo-arm {
            animation: none
          }
          .github-corner .octo-arm {
            animation: octocat-wave 560ms ease-in-out
          }
        }
      </style>
    </header>
    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 bd-sidebar">
          <nav class="collapse bd-links" id="bd-docs-nav">
            <div class="bd-toc-item active">
              <ul class="nav bd-sidenav">
                <li class="active bd-sidenav-active">
                  <a class="bd-toc-link" href="/doc-2.2.5/install.html">
                    Install
                  </a>
                </li>
                <li>
                  <a href="/doc-2.2.5/migrating.html">
                    Migrating from previous versions
                  </a>
                </li>
                <li class="active bd-sidenav-active">
                  <a class="bd-toc-link" href="#">
                    Starters
                  </a>
                </li>
                <li><a href="/doc-2.2.5/book.html">The book</a></li>
                <li>
                  <a href="/doc-2.2.5/presentations.html">Video Presentations</a>
                </li>
                <li>
                  <a href="/doc-2.2.5/help.html">How to find help</a>
                </li>
                <li>
                  <a href="/doc-2.2.5/faq.html">Frequently Asked Questions</a>
                </li>
                <li><a href="/doc-2.2.5/quick_start.html">Quickstart</a></li>
                <li>
                  <a href="/doc-2.2.5/complete_case.html">Complete case analysis</a>
                </li>
                <li>
                  <a href="/doc-2.2.5/cookbook.html">Cookbook</a>
                </li>
              </ul>
            </div>
            <div class="bd-toc-item active">
              <a class="bd-toc-link" href="#">
                Reference
              </a>
              <ul class="nav bd-sidenav">
                <li>
                  <a href="/doc-2.2.5/language.html">Script language</a></li>
                <li>
                  <a href="/doc-2.2.5/reference.html">Core API</a></li>
                <li>
                  <a href="/doc-2.2.5/reference-extras.html">Extra API</a></li>
                <li>
                  <a href="/doc-2.2.5/reference-deprecated.html">Deprecated API</a></li>
                <li>
                  <a href="/doc-2.2.5/multitrack.html">Multitrack</a></li>
                <li>
                  <a href="/doc-2.2.5/protocols.html">Protocols</a></li>
                <li>
                  <a href="/doc-2.2.5/settings.html">Settings</a></li>
                <li>
                  <a href="/doc-2.2.5/ffmpeg.html">FFmpeg support</a></li>
                <li>
                  <a href="/doc-2.2.5/encoding_formats.html">Encoding formats</a></li>
                <li>
                  <a href="/doc-2.2.5/video.html">Videos streams</a></li>
                <li>
                  <a href="/doc-2.2.5/memory.html">Memory management</a></li>
                <li>
                  <a href="/doc-2.2.5/json.html">JSON import/export</a></li>
                <li>
                  <a href="/doc-2.2.5/yaml.html">YAML import/export</a></li>
                <li>
                  <a href="/doc-2.2.5/ladspa.html">LADSPA plugins</a></li>
                <li>
                  <a href="/doc-2.2.5/playlist_parsers.html">Playlist parsers</a></li>
              </ul>
            </div>
            <div class="bd-toc-item active">
              <a class="bd-toc-link" href="#">
                Core
              </a>
              <ul class="nav bd-sidenav">
                <li>
                  <a href="/doc-2.2.5/sources.html">Sources</a></li>
                <li>
                  <a href="/doc-2.2.5/clocks.html">Clocks</a></li>
                <li>
                  <a href="/doc-2.2.5/requests.html">Requests</a></li>
                <li>
                  <a href="/doc-2.2.5/protocols-presentation.html">Protocols</a></li>
                <li>
                  <a href="/doc-2.2.5/stream_content.html">Stream contents</a></li>
                <li>
                  <a href="/doc-2.2.5/strings_encoding.html">Strings encoding</a></li>
                <li>
                  <a href="/doc-2.2.5/script_loading.html">Script loading</a></li>
                <li><a href="/doc-2.2.5/phases.html">Execution phases</a></li>
              </ul>
            </div>
            <div class="bd-toc-item active">
              <a class="bd-toc-link" href="#">
                Specific tutorials
              </a>
              <ul class="nav bd-sidenav">
                <li>
                  <a href="/doc-2.2.5/harbor_http.html">Using the HTTP server</a></li>
                <li>
                  <a href="/doc-2.2.5/blank.html">Blank detection</a></li>
                <li>
                  <a href="/doc-2.2.5/metadata.html">Customize metadata</a></li>
                <li>
                  <a href="/doc-2.2.5/seek.html">Seek and cue support</a></li>
                <li>
                  <a href="/doc-2.2.5/external_decoders.html">External decoders</a></li>
                <li>
                  <a href="/doc-2.2.5/external_streams.html">External streams</a></li>
                <li>
                  <a href="/doc-2.2.5/external_encoders.html">External encoders</a></li>
                <li>
                  <a href="/doc-2.2.5/hls_output.html">HLS output</a></li>
                <li>
                  <a href="/doc-2.2.5/http_input.html">HTTP input</a></li>
                <li>
                  <a href="/doc-2.2.5/harbor.html">Harbor input</a></li>
                <li>
                  <a href="/doc-2.2.5/stereotool.html">Stereotool</a></li>
                <li>
                  <a href="/doc-2.2.5/server.html">Using the telnet server</a></li>
                <li>
                  <a href="/doc-2.2.5/icy_metadata.html">ICY metadata update</a></li>
                <li>
                  <a href="/doc-2.2.5/replay_gain.html">Normalization and replay gain</a></li>
                <li>
                  <a href="/doc-2.2.5/request_sources.html">Requests-based sources</a></li>
                <li>
                  <a href="/doc-2.2.5/shoutcast.html">Shoutcast output</a></li>
                <li>
                  <a href="/doc-2.2.5/dynamic_sources.html">Dynamic source creation</a></li>
                <li>
                  <a href="/doc-2.2.5/crossfade.html">Crossfading</a></li>
                <li>
                  <a href="/doc-2.2.5/in_production.html">Using in production</a></li>
              </ul>
              <ul class="nav bd-sidenav">
                <li>
                  <a class="bd-toc-link" href="#">
                    User scripts
                  </a>
                </li>
                <li>
                  <a href="/doc-2.2.5/beets.html">Beets</a></li>
                <li>
                  <a href="/doc-2.2.5/geekradio.html">Geekradio</a></li>
                <li>
                  <a href="/doc-2.2.5/radiopi.html">RadioPi</a></li>
                <li>
                  <a href="/doc-2.2.5/dolebrai.html">Dolebraï</a></li>
                <li>
                  <a href="/doc-2.2.5/frequence3.html">Frequence3</a></li>
                <li>
                  <a href="/doc-2.2.5/video-static.html">Video with a single static image</a></li>
                <li>
                  <a href="/doc-2.2.5/split-cue.html">Split a CUE sheet</a></li>
              </ul>
              <ul class="nav bd-sidenav">
                <li>
                  <a class="bd-toc-link" href="#">
                    Behind the curtains
                  </a>
                </li>
                <li>
                  <a href="/doc-2.2.5/publications.html">Some presentations and publications</a></li>
                <li>
                  <a href="https://github.com/savonet">OCaml libraries</a></li>
                <li class="active bd-sidenav-active">
                  <a class="bd-toc-link" href="/legacy">
                    Legacy website
                  </a>
                </li>
              </ul>
            </div>
          </nav>
        </div>
        <!--
          <div class="d-none d-xl-block col-xl-2 bd-toc">
          <ul class="section-nav">
          <li class="toc-entry toc-h2">
          <a href="#quick-start">Quick start</a>
          <ul>
          <li class="toc-entry toc-h3">
          <a href="#css">CSS</a>
          </li>
          <li class="toc-entry toc-h3">
          <a href="#js">JS</a>
          </li>
          <li class="toc-entry toc-h3">
          <a href="#fonts-and-icons">Fonts and Icons</a>
          </li>
          </ul>
          </li>
          <li class="toc-entry toc-h2">
          <a href="#starter-template">Starter template</a>
          </li>
          </ul>
          </div>
        -->
          <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content" role="main">
          <h1 id="radiopi"><a href="#radiopi"
class="anchor">RadioPi</a></h1>
<p><a href="http://www.radiopi.org">RadioPi</a> is the web radio of the
ECP (Ecole Centrale de Paris). RadioPi runs many channels. There are
topical channels (Reggae, Hip-Hop, Jazz, …). On top of that, they
periodically broadcast live shows, which are relayed on all
channels.</p>
<p>We met a RadioPi manager right after having released Liquidsoap
0.2.0, and he was seduced by the system. They needed quite complex
features, which they were at that time fulfilling using dirty tricks,
loads of obfuscated scripts. Using Liquidsoap now allow them to do all
they want in an integrated way, but also provided new features.</p>
<h3 id="the-migration-process"><a href="#the-migration-process"
class="anchor">The migration process</a></h3>
<p>Quite easy actually. They used to have many instances Ices2, each of
these calling a Perl script to get the next song. Other scripts were
used for switching channels to live shows.</p>
<p>Now they have this single Liquidsoap script, no more. It calls
external scripts to interact with their web-based song scheduling
system. And they won new features: blank detection and distributed
encoding.</p>
<p>The first machine gets its files from a ftp server opened on the
second machine. Liquidsoap handles download automatically.</p>
<p>Each file is given by an external script,
<code>radiopilote-getnext</code>, whose answer looks as follows (except
that it’s on a single line):</p>
<pre><code>annotate:file_id=&quot;3541&quot;,length=&quot;400.613877551&quot;,\
  type=&quot;chansons&quot;,title=&quot;John Holt - Holigan&quot;,\
  artist=&quot;RadioPi - Canal reggae&quot;,\
  album=&quot;Studio One SeleKta! - Album Studio 1 12&quot;,\
  canal=&quot;reggae&quot;:ftp://***:***@host/files/3541.mp3</code></pre>
<p>Note that we use annotate to pass some variables to liquidsoap…</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ot">#!/usr/bin/liquidsoap</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard settings</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="dt">log.file.set</span>(<span class="dv">true</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="dt">log.file.path.set</span>(<span class="st">&quot;/var/log/liquidsoap/pi.log&quot;</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="dt">log.stdout.set</span>(<span class="dv">false</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="dt">init.daemon.set</span>(<span class="dv">true</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="dt">init.daemon.pidfile.path.set</span>(<span class="st">&quot;/var/run/liquidsoap/pi.pid&quot;</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Enable telnet server</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="dt">settings.server.telnet.set</span>(<span class="dv">true</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Enable harbor for any external</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># connection</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="dt">settings.harbor.bind_addrs.set</span>([<span class="st">&quot;0.0.0.0&quot;</span>])</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Verbose logs</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="dt">log.level.set</span>(<span class="dv">4</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># We use the scheduler intensively,</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># therefore we create many queues.</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="dt">settings.scheduler.generic_queues.set</span>(<span class="dv">5</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="dt">settings.scheduler.fast_queues.set</span>(<span class="dv">3</span>)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="dt">settings.scheduler.non_blocking_queues.set</span>(<span class="dv">3</span>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co"># === Settings ===</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="co"># The host to request files</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="va">stream</span> = <span class="st">&quot;XXXxXXXx&quot;</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co"># The command to request files</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="va">scripts</span> = <span class="st">&quot;ssh XXxxxXXX@#{stream} &#39;/path/to/scripts/&quot;</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co"># A substitution on the returned path</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="va">sed</span> = <span class="st">&quot; | sed -e s#/path/to/files/#ftp://user:password@#{stream}/#&#39;&quot;</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Enable replay gain</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="dt">enable_replaygain_metadata</span> ()</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="va">pass</span> = <span class="st">&quot;XXxXXXXx&quot;</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="va">ice_host</span> = <span class="st">&quot;localhost&quot;</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="va">descr</span> = <span class="st">&quot;RadioPi&quot;</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="va">url</span> = <span class="st">&quot;http://radiopi.org&quot;</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="co"># === Live ===</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="co"># A live source, on which we strip blank (make the source</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="co"># unavailable when streaming blank)</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="va">live</span> =</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>  <span class="dt">blank.strip</span>(</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    <span class="dt">input.harbor</span>(<span class="va">id</span>=<span class="st">&quot;live&quot;</span>, <span class="va">port</span>=<span class="dv">8000</span>, <span class="va">password</span>=pass,</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>                 <span class="va">buffer</span>=<span class="fl">8.</span>,<span class="va">max</span>=<span class="fl">20.</span>,<span class="st">&quot;live.ogg&quot;</span>),</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    <span class="va">length</span>=<span class="fl">10.</span>, <span class="va">threshold</span>=<span class="fl">-50.</span>)</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="co"># This source relays the live data, when available,</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="co"># to the other streamer, in uncompressed format (WAV)</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="dt">output.icecast</span>(<span class="ot">%wav</span>, <span class="va">host</span>=stream,</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>               <span class="va">port</span>=<span class="dv">8005</span>, <span class="va">password</span>=pass,</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>               <span class="va">mount</span>=<span class="st">&quot;live.ogg&quot;</span>, <span class="va">fallible</span>=<span class="dv">true</span>,</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>               live)</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="co"># This source relays the live source to &quot;live.ogg&quot;. This</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a><span class="co"># is used for debugging purposes, to see what is sent</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="co"># to the harbor source.</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a><span class="dt">output.icecast</span>(<span class="ot">%vorbis</span>, <span class="va">host</span>=<span class="st">&quot;127.0.0.1&quot;</span>,</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>               <span class="va">port</span>=<span class="dv">8080</span>, <span class="va">password</span>=pass,</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>               <span class="va">mount</span>=<span class="st">&quot;live.ogg&quot;</span>, <span class="va">fallible</span>=<span class="dv">true</span>,</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>               live)</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a><span class="co"># This source starts an archive of the live stream</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a><span class="co"># when available</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a><span class="va">title</span> = &#39;$(<span class="kw">if</span> $(title),<span class="st">&quot;$(title)&quot;</span>,\</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Emission inconnue&quot;</span>)$(<span class="kw">if</span> $(artist), \</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot; par  $(artist)&quot;</span>) - <span class="ot">%m</span>-<span class="ot">%d</span>-<span class="ot">%Y</span>, <span class="ot">%H</span>:<span class="ot">%M</span>:<span class="ot">%S</span>&#39;</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a><span class="dt">output.file</span>(<span class="ot">%vorbis</span>, <span class="va">reopen_on_metadata</span>=<span class="dv">true</span>,</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>            <span class="va">fallible</span>=<span class="dv">true</span>,</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;/data/archives/brutes/&quot;</span> ^ title ^ <span class="st">&quot;.ogg&quot;</span>,</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>            live)</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a><span class="co"># === Channels ===</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Specialize the output functions by partial application</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a><span class="va">output.icecast</span> = <span class="dt">output.icecast</span>(<span class="va">description</span>=descr, <span class="va">url</span>=url)</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a><span class="va">out</span> = <span class="dt">output.icecast</span>(<span class="va">host</span>=ice_host,<span class="va">port</span>=<span class="dv">8080</span>,<span class="va">password</span>=pass,<span class="va">fallible</span>=<span class="dv">true</span>)</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a><span class="va">out_aac32</span> = <span class="dt">out</span>(<span class="ot">%fdkaac</span>(<span class="va">bitrate</span>=<span class="dv">32</span>))</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a><span class="va">out_aac</span> = <span class="dt">out</span>(<span class="ot">%fdkaac</span>(<span class="va">bitrate</span>=<span class="dv">64</span>))</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a><span class="va">out</span> = <span class="dt">out</span>(<span class="ot">%mp3</span>)</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a><span class="co"># A file for playing during failures</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a><span class="va">interlude</span> =</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>  <span class="dt">single</span>(<span class="st">&quot;/home/radiopi/fallback.mp3&quot;</span>)</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Lastfm submission</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="dt">lastfm</span> (m) =</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> (m[<span class="st">&quot;type&quot;</span>] == <span class="st">&quot;chansons&quot;</span>) <span class="kw">then</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> (m[<span class="st">&quot;canal&quot;</span>] == <span class="st">&quot;reggae&quot;</span> <span class="kw">or</span> m[<span class="st">&quot;canal&quot;</span>] == <span class="st">&quot;Jazz&quot;</span> <span class="kw">or</span> m[<span class="st">&quot;canal&quot;</span>] == <span class="st">&quot;That70Sound&quot;</span>) <span class="kw">then</span></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>      <span class="va">canal</span> =</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> (m[<span class="st">&quot;canal&quot;</span>] == <span class="st">&quot;That70Sound&quot;</span>) <span class="kw">then</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;70sound&quot;</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>       m[<span class="st">&quot;canal&quot;</span>]</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>      <span class="va">user</span> = <span class="st">&quot;radiopi-&quot;</span> ^ canal</span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>      <span class="dt">lastfm.submit</span>(<span class="va">user</span>=user,<span class="va">password</span>=<span class="st">&quot;xXXxx&quot;</span>,m)</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a><span class="co"># === Basic sources ===</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom crossfade to deal with jingles..</span></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="dt">crossfade</span> (<span class="va">~start_next</span>=<span class="fl">5.</span>,<span class="va">~fade_in</span>=<span class="fl">3.</span>,<span class="va">~fade_out</span>=<span class="fl">3.</span>,</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>               <span class="va">~default</span>=(<span class="kw">fun</span> (a,b) -&gt; <span class="dt">sequence</span>([a, b])),</span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>               <span class="va">~high</span>=<span class="fl">-15.</span>, <span class="va">~medium</span>=<span class="fl">-32.</span>, <span class="va">~margin</span>=<span class="fl">4.</span>,</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>               <span class="va">~width</span>=<span class="fl">2.</span>,<span class="va">~conservative</span>=<span class="dv">false</span>,s)</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>  <span class="va">fade.out</span> = <span class="dt">fade.out</span>(<span class="va">type</span>=<span class="st">&quot;sin&quot;</span>,<span class="va">duration</span>=fade_out)</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>  <span class="va">fade.in</span>  = <span class="dt">fade.in</span>(<span class="va">type</span>=<span class="st">&quot;sin&quot;</span>,<span class="va">duration</span>=fade_in)</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>  <span class="va">add</span> = <span class="kw">fun</span> (a,b) -&gt; <span class="dt">add</span>(<span class="va">normalize</span>=<span class="dv">false</span>,[b, a])</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>  <span class="va">log</span> = <span class="dt">log</span>(<span class="va">label</span>=<span class="st">&quot;crossfade&quot;</span>)</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="dt">transition</span>(a,b,ma,mb,sa,sb)</span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>    <span class="dt">list.iter</span>(<span class="kw">fun</span>(x)-&gt; <span class="dt">log</span>(<span class="va">level</span>=<span class="dv">4</span>,<span class="st">&quot;Before: #{x}&quot;</span>),ma)</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>    <span class="dt">list.iter</span>(<span class="kw">fun</span>(x)-&gt; <span class="dt">log</span>(<span class="va">level</span>=<span class="dv">4</span>,<span class="st">&quot;After : #{x}&quot;</span>),mb)</span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> ma[<span class="st">&quot;type&quot;</span>] == <span class="st">&quot;jingles&quot;</span> <span class="kw">or</span> mb[<span class="st">&quot;type&quot;</span>] == <span class="st">&quot;jingles&quot;</span> <span class="kw">then</span></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>      <span class="dt">log</span>(<span class="st">&quot;Old or new file is a jingle: sequenced transition.&quot;</span>)</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>      <span class="dt">sequence</span>([sa, sb])</span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>    <span class="kw">elsif</span></span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If A and B are not too loud and close, fully cross-fade them.</span></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>      a &lt;= medium <span class="kw">and</span> b &lt;= medium <span class="kw">and</span> <span class="dt">abs</span>(a - b) &lt;= margin</span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>    <span class="kw">then</span></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>      <span class="dt">log</span>(<span class="st">&quot;Old &lt;= medium, new &lt;= medium and |old-new| &lt;= margin.&quot;</span>)</span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>      <span class="dt">log</span>(<span class="st">&quot;Old and new source are not too loud and close.&quot;</span>)</span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>      <span class="dt">log</span>(<span class="st">&quot;Transition: crossed, fade-in, fade-out.&quot;</span>)</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>      <span class="dt">add</span>(<span class="dt">fade.out</span>(sa),<span class="dt">fade.in</span>(sb))</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>    <span class="kw">elsif</span></span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If B is significantly louder than A, only fade-out A.</span></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>      <span class="co"># We don&#39;t want to fade almost silent things, ask for &gt;medium.</span></span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>      b &gt;= a + margin <span class="kw">and</span> a &gt;= medium <span class="kw">and</span> b &lt;= high</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>    <span class="kw">then</span></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>      <span class="dt">log</span>(<span class="st">&quot;new &gt;= old + margin, old &gt;= medium and new &lt;= high.&quot;</span>)</span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>      <span class="dt">log</span>(<span class="st">&quot;New source is significantly louder than old one.&quot;</span>)</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>      <span class="dt">log</span>(<span class="st">&quot;Transition: crossed, fade-out.&quot;</span>)</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>      <span class="dt">add</span>(<span class="dt">fade.out</span>(sa),sb)</span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>    <span class="kw">elsif</span></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Opposite as the previous one.</span></span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>      a &gt;= b + margin <span class="kw">and</span> b &gt;= medium <span class="kw">and</span> a &lt;= high</span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>    <span class="kw">then</span></span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>      <span class="dt">log</span>(<span class="st">&quot;old &gt;= new + margin, new &gt;= medium and old &lt;= high&quot;</span>)</span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>      <span class="dt">log</span>(<span class="st">&quot;Old source is significantly louder than new one.&quot;</span>)</span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>      <span class="dt">log</span>(<span class="st">&quot;Transition: crossed, fade-in.&quot;</span>)</span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>      <span class="dt">add</span>(sa,<span class="dt">fade.in</span>(sb))</span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>    <span class="kw">elsif</span></span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Do not fade if it&#39;s already very low.</span></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>      b &gt;= a + margin <span class="kw">and</span> a &lt;= medium <span class="kw">and</span> b &lt;= high</span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>    <span class="kw">then</span></span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>      <span class="dt">log</span>(<span class="st">&quot;new &gt;= old + margin, old &lt;= medium and new &lt;= high.&quot;</span>)</span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>      <span class="dt">log</span>(<span class="st">&quot;Do not fade if it&#39;s already very low.&quot;</span>)</span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>      <span class="dt">log</span>(<span class="st">&quot;Transition: crossed, no fade.&quot;</span>)</span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>      <span class="dt">add</span>(sa,sb)</span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>    <span class="co"># What to do with a loud end and a quiet beginning ?</span></span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>    <span class="co"># A good idea is to use a jingle to separate the two tracks,</span></span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>    <span class="co"># but that&#39;s another story.</span></span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span></span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Otherwise, A and B are just too loud to overlap nicely,</span></span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>      <span class="co"># or the difference between them is too large and overlapping would</span></span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>      <span class="co"># completely mask one of them.</span></span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>      <span class="dt">log</span>(<span class="st">&quot;No transition: using default.&quot;</span>)</span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>      <span class="dt">default</span>(sa, sb)</span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>  <span class="dt">cross</span>(<span class="va">width</span>=width, <span class="va">duration</span>=start_next, <span class="va">conservative</span>=conservative,</span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>              transition,s)</span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a radiopilote-driven source</span></span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="dt">channel_radiopilote</span>(<span class="va">~skip</span>=<span class="dv">true</span>,name)</span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a>  <span class="dt">log</span>(<span class="st">&quot;Creating canal #{name}&quot;</span>)</span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Request function</span></span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="dt">request</span> () =</span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>    <span class="dt">log</span>(<span class="st">&quot;Request for #{name}&quot;</span>)</span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a>    <span class="va">ret</span> = <span class="dt">list.hd</span>(<span class="dt">process.read.lines</span>(scripts^<span class="st">&quot;radiopilote-getnext &quot;</span>^<span class="dt">quote</span>(name)^sed))</span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a>    <span class="dt">log</span>(<span class="st">&quot;Got answer: #{ret} for #{name}&quot;</span>)</span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>    [<span class="dt">request.create</span>(ret)]</span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the request.dynamic.list source</span></span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set conservative to true to queue</span></span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>  <span class="co"># several songs in advance</span></span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a>  <span class="va">source</span> =</span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a>    <span class="dt">request.dynamic.list</span>(<span class="va">conservative</span>=<span class="dv">true</span>, <span class="va">length</span>=<span class="fl">400.</span>,</span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a>                    <span class="va">id</span>=<span class="st">&quot;dyn_&quot;</span>^name,request,</span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a>                    <span class="va">timeout</span>=<span class="fl">60.</span>)</span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply normalization using replaygain</span></span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a>  <span class="co"># information</span></span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a>  <span class="va">source</span> =   <span class="dt">amplify</span>(<span class="fl">1.</span>,<span class="va">override</span>=<span class="st">&quot;replay_gain&quot;</span>, source)</span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Skip blank when asked to</span></span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a>  <span class="va">source</span> =</span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> skip <span class="kw">then</span></span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a>      <span class="dt">blank.skip</span>(source, <span class="va">length</span>=<span class="fl">10.</span>, <span class="va">threshold</span>=<span class="fl">-40.</span>)</span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span></span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a>      source</span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Submit new tracks on lastfm</span></span>
<span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a>  <span class="va">source</span> = <span class="dt">on_metadata</span>(lastfm,source)</span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Tell the system when a new track</span></span>
<span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a>  <span class="co"># is played</span></span>
<span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a>  <span class="va">source</span> = <span class="dt">on_metadata</span>(<span class="kw">fun</span> (meta) -&gt;</span>
<span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">system</span>(scripts ^ <span class="st">&quot;radiopilote-feedback &quot;</span></span>
<span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a>                           ^<span class="dt">quote</span>(meta[<span class="st">&quot;canal&quot;</span>])^<span class="st">&quot; &quot;</span></span>
<span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a>                           ^<span class="dt">quote</span>(meta[<span class="st">&quot;file_id&quot;</span>]) ^ <span class="st">&quot;&#39;&quot;</span>), source)</span>
<span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Finally apply a smart crossfading</span></span>
<span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a>  <span class="dt">crossfade</span>(source)</span>
<span id="cb2-226"><a href="#cb2-226" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb2-227"><a href="#cb2-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-228"><a href="#cb2-228" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic source</span></span>
<span id="cb2-229"><a href="#cb2-229" aria-hidden="true" tabindex="-1"></a><span class="va">jazz</span> = <span class="dt">channel_radiopilote</span>(<span class="st">&quot;jazz&quot;</span>)</span>
<span id="cb2-230"><a href="#cb2-230" aria-hidden="true" tabindex="-1"></a><span class="va">discoqueen</span> = <span class="dt">channel_radiopilote</span>(<span class="st">&quot;discoqueen&quot;</span>)</span>
<span id="cb2-231"><a href="#cb2-231" aria-hidden="true" tabindex="-1"></a><span class="co"># Avoid skipping blank with classic music !!</span></span>
<span id="cb2-232"><a href="#cb2-232" aria-hidden="true" tabindex="-1"></a><span class="va">classique</span> = <span class="dt">channel_radiopilote</span>(<span class="va">skip</span>=<span class="dv">false</span>,<span class="st">&quot;classique&quot;</span>)</span>
<span id="cb2-233"><a href="#cb2-233" aria-hidden="true" tabindex="-1"></a><span class="va">That70Sound</span> = <span class="dt">channel_radiopilote</span>(<span class="st">&quot;That70Sound&quot;</span>)</span>
<span id="cb2-234"><a href="#cb2-234" aria-hidden="true" tabindex="-1"></a><span class="va">metal</span> = <span class="dt">channel_radiopilote</span>(<span class="st">&quot;metal&quot;</span>)</span>
<span id="cb2-235"><a href="#cb2-235" aria-hidden="true" tabindex="-1"></a><span class="va">reggae</span> = <span class="dt">channel_radiopilote</span>(<span class="st">&quot;reggae&quot;</span>)</span>
<span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a><span class="va">Rock</span> = <span class="dt">channel_radiopilote</span>(<span class="st">&quot;Rock&quot;</span>)</span>
<span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a><span class="co"># Group those sources in a separate</span></span>
<span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a><span class="co"># clock (good for multithreading/multicore)</span></span>
<span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a><span class="dt">clock.assign_new</span>([jazz,That70Sound,metal,reggae])</span>
<span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a><span class="co"># === Mixing live ===</span></span>
<span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a><span class="co"># To create a channel from a basic source, add:</span></span>
<span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a><span class="co"># - a new-track notification for radiopilote</span></span>
<span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a><span class="co"># - metadata rewriting</span></span>
<span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a><span class="co"># - the live shows</span></span>
<span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a><span class="co"># - the failsafe &#39;interlude&#39; source to channels</span></span>
<span id="cb2-249"><a href="#cb2-249" aria-hidden="true" tabindex="-1"></a><span class="co"># - blank detection</span></span>
<span id="cb2-250"><a href="#cb2-250" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="dt">mklive</span>(source) =</span>
<span id="cb2-251"><a href="#cb2-251" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transition function: if transitioning</span></span>
<span id="cb2-252"><a href="#cb2-252" aria-hidden="true" tabindex="-1"></a>  <span class="co"># to the live, fade out the old source</span></span>
<span id="cb2-253"><a href="#cb2-253" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if transitioning from live, fade.in</span></span>
<span id="cb2-254"><a href="#cb2-254" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the new source. NOTE: We cannot</span></span>
<span id="cb2-255"><a href="#cb2-255" aria-hidden="true" tabindex="-1"></a>  <span class="co"># skip the current song because</span></span>
<span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a>  <span class="co"># reloading new songs for all the</span></span>
<span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sources when live starts costs too much</span></span>
<span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a>  <span class="co"># CPU.</span></span>
<span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="dt">trans</span>(old,new) =</span>
<span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="dt">source.id</span>(new) == <span class="dt">source.id</span>(live) <span class="kw">then</span></span>
<span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a>      <span class="dt">log</span>(<span class="st">&quot;Transition to live!&quot;</span>)</span>
<span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a>      <span class="dt">add</span>([new,<span class="dt">fade.out</span>(old)])</span>
<span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a>    <span class="kw">elsif</span> <span class="dt">source.id</span>(old) == <span class="dt">source.id</span>(live) <span class="kw">then</span></span>
<span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a>      <span class="dt">log</span>(<span class="st">&quot;Transitioning from live!&quot;</span>)</span>
<span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a>      <span class="dt">add</span>([<span class="dt">fade.in</span>(new),old])</span>
<span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span></span>
<span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a>      <span class="dt">log</span>(<span class="st">&quot;Dummy transition&quot;</span>)</span>
<span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a>      new</span>
<span id="cb2-269"><a href="#cb2-269" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb2-270"><a href="#cb2-270" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb2-271"><a href="#cb2-271" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fallback</span>(<span class="va">track_sensitive</span>=<span class="dv">false</span>,</span>
<span id="cb2-272"><a href="#cb2-272" aria-hidden="true" tabindex="-1"></a>    <span class="va">transitions</span>=[trans,trans,trans],</span>
<span id="cb2-273"><a href="#cb2-273" aria-hidden="true" tabindex="-1"></a>    [live,source,interlude])</span>
<span id="cb2-274"><a href="#cb2-274" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb2-275"><a href="#cb2-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-276"><a href="#cb2-276" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a channel using mklive(), encode and output it to icecast.</span></span>
<span id="cb2-277"><a href="#cb2-277" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="dt">mkoutput</span>(<span class="va">~out</span>=out,mount,source,name,genre)</span>
<span id="cb2-278"><a href="#cb2-278" aria-hidden="true" tabindex="-1"></a>  <span class="dt">out</span>(<span class="va">id</span>=mount,<span class="va">mount</span>=mount,<span class="va">name</span>=name,<span class="va">genre</span>=genre,</span>
<span id="cb2-279"><a href="#cb2-279" aria-hidden="true" tabindex="-1"></a>     <span class="dt">mklive</span>(source)</span>
<span id="cb2-280"><a href="#cb2-280" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb2-281"><a href="#cb2-281" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb2-282"><a href="#cb2-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-283"><a href="#cb2-283" aria-hidden="true" tabindex="-1"></a><span class="co"># === Outputs ===</span></span>
<span id="cb2-284"><a href="#cb2-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-285"><a href="#cb2-285" aria-hidden="true" tabindex="-1"></a><span class="dt">mkoutput</span>(<span class="st">&quot;jazz&quot;</span>, jazz, <span class="st">&quot;RadioPi - Canal Jazz&quot;</span>,<span class="st">&quot;jazz&quot;</span>)</span>
<span id="cb2-286"><a href="#cb2-286" aria-hidden="true" tabindex="-1"></a><span class="dt">mkoutput</span>(<span class="st">&quot;discoqueen&quot;</span>, discoqueen, <span class="st">&quot;RadioPi - Canal DiscoQueen&quot;</span>,<span class="st">&quot;discoqueen&quot;</span>)</span>
<span id="cb2-287"><a href="#cb2-287" aria-hidden="true" tabindex="-1"></a><span class="dt">mkoutput</span>(<span class="st">&quot;classique&quot;</span>, classique, <span class="st">&quot;RadioPi - Canal Classique&quot;</span>,<span class="st">&quot;classique&quot;</span>)</span>
<span id="cb2-288"><a href="#cb2-288" aria-hidden="true" tabindex="-1"></a><span class="dt">mkoutput</span>(<span class="st">&quot;That70Sound&quot;</span>, That70Sound,</span>
<span id="cb2-289"><a href="#cb2-289" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;RadioPi - Canal That70Sound&quot;</span>,<span class="st">&quot;That70Sound&quot;</span>)</span>
<span id="cb2-290"><a href="#cb2-290" aria-hidden="true" tabindex="-1"></a><span class="dt">mkoutput</span>(<span class="st">&quot;metal&quot;</span>, metal, <span class="st">&quot;RadioPi - Canal Metal&quot;</span>,<span class="st">&quot;metal&quot;</span>)</span>
<span id="cb2-291"><a href="#cb2-291" aria-hidden="true" tabindex="-1"></a><span class="dt">mkoutput</span>(<span class="st">&quot;reggae&quot;</span>, reggae, <span class="st">&quot;RadioPi - Canal Reggae&quot;</span>,<span class="st">&quot;reggae&quot;</span>)</span>
<span id="cb2-292"><a href="#cb2-292" aria-hidden="true" tabindex="-1"></a><span class="dt">mkoutput</span>(<span class="st">&quot;Rock&quot;</span>, Rock, <span class="st">&quot;RadioPi - Canal Rock&quot;</span>,<span class="st">&quot;Rock&quot;</span>)</span>
<span id="cb2-293"><a href="#cb2-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-294"><a href="#cb2-294" aria-hidden="true" tabindex="-1"></a><span class="co"># Test outouts</span></span>
<span id="cb2-295"><a href="#cb2-295" aria-hidden="true" tabindex="-1"></a><span class="dt">mkoutput</span>(<span class="va">out</span>=out_aac,<span class="st">&quot;reggae.aacp&quot;</span>, reggae, <span class="st">&quot;RadioPi - Canal Reggae \</span></span>
<span id="cb2-296"><a href="#cb2-296" aria-hidden="true" tabindex="-1"></a><span class="st">                                     (64 kbits AAC+ test stream)&quot;</span>,<span class="st">&quot;reggae&quot;</span>)</span>
<span id="cb2-297"><a href="#cb2-297" aria-hidden="true" tabindex="-1"></a><span class="dt">mkoutput</span>(<span class="va">out</span>=out_aac32,<span class="st">&quot;reggae.aacp32&quot;</span>, reggae, <span class="st">&quot;RadioPi - Canal Reggae \</span></span>
<span id="cb2-298"><a href="#cb2-298" aria-hidden="true" tabindex="-1"></a><span class="st">                                      (32 kbits AAC+ test stream)&quot;</span>,<span class="st">&quot;reggae&quot;</span>)</span></code></pre></div>
<p>The other machine has a similar configuration except that files are
local, but this is exactly the same for liquidsoap !</p>
<p>Using harbor, the live connects directly to liquidsoap, using port
<code>8000</code> (icecast runs on port <code>8080</code>). Then,
liquidsoap starts a relay to the other encoder, and both switch their
channels to the new live.</p>
<p>Additionally, a file output is started upon live connection, in order
to backup the stream. You could also add a relay to icecast in order to
manually check what’s received by the harbor.</p>
          <div id="footer"></div>
        </main>
      </div>
    </div>
    <!--   Core JS Files   -->

    <script src="/assets/js/core/jquery.min.js" type="text/javascript"></script>
    <script src="/assets/js/core/popper.min.js" type="text/javascript"></script>
    <script src="/assets/js/core/bootstrap-material-design.min.js" type="text/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript"></script>
    <script src="/assets/js/liq-jquery.js" type="text/javascript"></script>
  </body>

</html>
