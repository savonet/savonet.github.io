<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/png" href="/assets/img/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Liquidsoap</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
    <!-- Extra details for Live View on GitHub Pages -->
    <!-- Canonical SEO -->
    <link rel="canonical" href="https://www.liquidsoap.info/" />
    <!--  Social tags      -->
    <meta name="keywords" content="radio, audio, video, streaming, icecast, shoutcast">
    <meta name="description" content="Swiss-army knife for multimedia streaming">
    <!-- Schema.org markup for Google+ -->
    <meta itemprop="name" content="Liquidsoap Streaming Language">
    <meta itemprop="description" content="Swiss-army knife for multimedia streaming">
    <!-- Twitter Card data -->
    <meta name="twitter:card" content="product">
    <meta name="twitter:site" content="@LiquidsoapMedia">
    <meta name="twitter:title" content="Liquidsoap Streaming Language">
    <meta name="twitter:description" content="Swiss-army knife for multimedia streaming">
    <meta name="twitter:creator" content="@LiquidsoapMedia">
    <meta name="twitter:image" content="https://www.liquidsoap.info//assets/img/bottle_invert.png">
    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
    <!-- CSS Files -->
    <link href="/assets/css/custom.css" rel="stylesheet" />
    <link href="/assets/css/material-kit.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
    <!-- Documentation extras -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
    <link rel="stylesheet" href="/assets/demo/docs.min.css">
    <style>
    .navbar-absolute-logo {
      padding-left: 45px;
    }

    .navbar-absolute-logo img {
      position: absolute;
      left: 15px;
      margin-top: -6px;
    }

    body {
      background: white;
    }

    p {
        font-size: 16px;
        text-align: justify;
    }
    </style>
    <style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    </style>
  </head>

  <body class="bd-docs" data-spy="scroll" data-target=".bd-sidenav-active">
    <a id="skippy" class="sr-only sr-only-focusable" href="#content">
      <div class="container">
        <span class="skiplink-text">Skip to main content</span>
      </div>
    </a>
    <header class="navbar navbar-expand navbar-dark bg-primary flex-column flex-md-row bd-navbar">
      <a class="navbar-brand mr-0 mr-md-2 navbar-absolute-logo" href="/doc-2.3.2">
        <svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 600 600" focusable="false" style="width: 25px; height: 25px;">
          <title>Liquidsoap</title>
          <style type="text/css">
.st0{fill:#FFFFFF;}
          </style>
          <g>
          <path class="st0" d="M102.4,593.8c-0.7-2.8-3.4-2.5-5.3-3.3c-24.6-10.2-37.2-28.7-37.2-55.6c-0.1-72.1,0-144.2,0-216.3
          c0-52.3,0-104.6,0-156.9c0-37.6,23.1-60.9,60.6-61.1c12-0.1,23.9-0.2,35.9,0c15.7,0.3,26.7,10.1,26.3,23
          c-0.4,12.5-11.1,21.5-26.3,21.8c-12,0.2-23.9-0.1-35.9,0.1c-11.8,0.1-15.6,3.7-15.6,15.3c-0.1,124.4,0,248.8-0.1,373.2
          c0,10.3,4.5,15.1,14.8,15.1c69.1-0.1,138.2,0,207.3-0.1c12.3,0,15.5-3.7,15.5-17.7c0-74.7,0-149.4,0-224.2c0-47.8,0-95.6,0-143.5
          c0-15.2-3-18.1-18.4-18.2c-10.8,0-21.7,0.1-32.5,0c-16-0.2-26.7-9.4-26.6-22.5c0.1-13,10.9-22.1,26.9-22.3
          c13.4-0.2,26.9-0.3,40.3,0.1c30.8,1,54.9,24.5,55,55.2c0.3,127.4,0.3,254.8,0.1,382.2c0,25.5-15.8,45.7-40.2,53.3
          c-1.7,0.5-3.8,0-4.5,2.4C262.3,593.8,182.4,593.8,102.4,593.8z"/>
          <path class="st0" d="M537.4,212.6c-16.8,23-56.5,16.5-68.6-9.5c-8-17.2-12.4-32.7-12-54.5c4.6,4.1,8.3,7.5,12.1,10.7
          c10.3,8.6,21,14,35.5,11.8c12.5-1.9,21.5,6,28.2,16.3c2,3,1.3,7.3,4.8,9.5C537.4,202.2,537.4,207.4,537.4,212.6z"/>
          <path class="st0" d="M200.6,230.4c0-55.3,0-110.5,0-165.8c0-40.7,22.3-62.7,63.2-62.7c50.4,0,100.8,0,151.3,0
          c36.1,0,59.1,21.9,60.4,57.7c0.5,13.1,0.4,26.1,0,39.2c-0.4,15.1-10.1,25.8-22.5,25.7c-12-0.1-21.6-10.1-22.3-24.8
          c-0.6-12.7-0.4-25.4-0.1-38.1c0.2-10.4-4.5-14.9-14.9-14.9c-51.5,0.1-103.1,0-154.6,0.1c-12.7,0-15.5,3.2-15.5,17.5
          c0,105.3,0,210.6,0,316c0,7.8,0.1,15.7,0,23.5c-0.2,17.5-9.4,28.9-23,28.6c-13.5-0.3-21.9-10.9-21.9-28.3
          C200.6,346.2,200.6,288.3,200.6,230.4z"/>
          </g>
        </svg>
        Liquidsoap
      </a>
      <ul class="navbar-nav flex-row d-none d-md-flex">
        <li class="nav-item dropdown">
          <a data-versions="dev 2.2.5 2.3.0 2.3.1 2.3.2 2.3.3
2.4.0" data-version="2.3.2" class="nav-item nav-link dropdown-toggle mr-md-2" href="#" id="liq-version" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            2.3.2
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="liq-version" id="liq-versions">
          </div>
        </li>
        <li class="nav-item">
          <a class="nav-link p-2" href="https://github.com/savonet/liquidsoap" target="_blank" rel="noopener" aria-label="GitHub">
            <svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 499.36" focusable="false">
              <title>GitHub</title>
              <path d="M256 0C114.64 0 0 114.61 0 256c0 113.09 73.34 209 175.08 242.9 12.8 2.35 17.47-5.56 17.47-12.34 0-6.08-.22-22.18-.35-43.54-71.2 15.49-86.2-34.34-86.2-34.34-11.64-29.57-28.42-37.45-28.42-37.45-23.27-15.84 1.73-15.55 1.73-15.55 25.69 1.81 39.21 26.38 39.21 26.38 22.84 39.12 59.92 27.82 74.5 21.27 2.33-16.54 8.94-27.82 16.25-34.22-56.84-6.43-116.6-28.43-116.6-126.49 0-27.95 10-50.8 26.35-68.69-2.63-6.48-11.42-32.5 2.51-67.75 0 0 21.49-6.88 70.4 26.24a242.65 242.65 0 0 1 128.18 0c48.87-33.13 70.33-26.24 70.33-26.24 14 35.25 5.18 61.27 2.55 67.75 16.41 17.9 26.31 40.75 26.31 68.69 0 98.35-59.85 120-116.88 126.32 9.19 7.9 17.38 23.53 17.38 47.41 0 34.22-.31 61.83-.31 70.23 0 6.85 4.61 14.81 17.6 12.31C438.72 464.97 512 369.08 512 256.02 512 114.62 397.37 0 256 0z" fill="currentColor" fill-rule="evenodd" />
            </svg>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link p-2" href="https://twitter.com/liquidsoapmedia" target="_blank" rel="noopener" aria-label="Twitter">
            <svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 416.32" focusable="false">
              <title>Twitter</title>
              <path d="M160.83 416.32c193.2 0 298.92-160.22 298.92-298.92 0-4.51 0-9-.2-13.52A214 214 0 0 0 512 49.38a212.93 212.93 0 0 1-60.44 16.6 105.7 105.7 0 0 0 46.3-58.19 209 209 0 0 1-66.79 25.37 105.09 105.09 0 0 0-181.73 71.91 116.12 116.12 0 0 0 2.66 24c-87.28-4.3-164.73-46.3-216.56-109.82A105.48 105.48 0 0 0 68 159.6a106.27 106.27 0 0 1-47.53-13.11v1.43a105.28 105.28 0 0 0 84.21 103.06 105.67 105.67 0 0 1-47.33 1.84 105.06 105.06 0 0 0 98.14 72.94A210.72 210.72 0 0 1 25 370.84a202.17 202.17 0 0 1-25-1.43 298.85 298.85 0 0 0 160.83 46.92" fill="currentColor" />
            </svg>
          </a>
        </li>
      </ul>
      <div class="navbar-nav-scroll ml-md-auto ">
        <ul class="navbar-nav bd-navbar-nav flex-row">
          <!--
            <li class="nav-item">
            <a class="nav-link" href=""> <i class="material-icons">card_membership</i> PRO Services </a>
            </li>
            -->
          <li class="nav-item">
            <script async src="https://cse.google.com/cse.js?cx=24f50f6f088994c53"></script>
            <style>
.cse .gsc-control-cse, .gsc-control-cse {
  background-color: transparent;
  border: none;
  width: 300px;
}
            </style>
            <div class="gcse-search"></div>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/savonet/liquidsoap/issues" target="_blank" rel="noopener"><i class="material-icons">star</i> Get Help</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="" target="_blank" rel="noopener"></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="" target="_blank" rel="noopener"></a>
          </li>
        </ul>
      </div>
      <a href="https://github.com/savonet/liquidsoap" class="github-corner" aria-label="View source on Github">
        <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#fff; color:#9c27b0; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
          <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
          <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
          <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
        </svg>
      </a>
      <style>
.github-corner:hover .octo-arm {
  animation: octocat-wave 560ms ease-in-out
}

        @keyframes octocat-wave {
          0%,
          100% {
            transform: rotate(0)
          }
          20%,
          60% {
            transform: rotate(-25deg)
          }
          40%,
          80% {
            transform: rotate(10deg)
          }
        }

        @media (max-width:500px) {
          .github-corner:hover .octo-arm {
            animation: none
          }
          .github-corner .octo-arm {
            animation: octocat-wave 560ms ease-in-out
          }
        }
      </style>
    </header>
    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 bd-sidebar">
          <nav class="collapse bd-links" id="bd-docs-nav">
            <div class="bd-toc-item active">
              <ul class="nav bd-sidenav">
                <li class="active bd-sidenav-active">
                  <a class="bd-toc-link" href="/doc-2.3.2/install.html">
                    Install
                  </a>
                </li>
                <li>
                  <a href="/doc-2.3.2/migrating.html">
                    Migrating from previous versions
                  </a>
                </li>
                <li class="active bd-sidenav-active">
                  <a class="bd-toc-link" href="#">
                    Starters
                  </a>
                </li>
                <li><a href="/doc-2.3.2/book.html">The book</a></li>
                <li>
                  <a href="/doc-2.3.2/presentations.html">Video Presentations</a>
                </li>
                <li>
                  <a href="/doc-2.3.2/help.html">How to find help</a>
                </li>
                <li>
                  <a href="/doc-2.3.2/faq.html">Frequently Asked Questions</a>
                </li>
                <li><a href="/doc-2.3.2/quick_start.html">Quickstart</a></li>
                <li>
                  <a href="/doc-2.3.2/complete_case.html">Complete case analysis</a>
                </li>
                <li>
                  <a href="/doc-2.3.2/cookbook.html">Cookbook</a>
                </li>
              </ul>
            </div>
            <div class="bd-toc-item active">
              <a class="bd-toc-link" href="#">
                Reference
              </a>
              <ul class="nav bd-sidenav">
                <li>
                  <a href="/doc-2.3.2/language.html">Script language</a></li>
                <li>
                  <a href="/doc-2.3.2/reference.html">Core API</a></li>
                <li>
                  <a href="/doc-2.3.2/reference-extras.html">Extra API</a></li>
                <li>
                  <a href="/doc-2.3.2/reference-deprecated.html">Deprecated API</a></li>
                <li>
                  <a href="/doc-2.3.2/multitrack.html">Multitrack</a></li>
                <li>
                  <a href="/doc-2.3.2/protocols.html">Protocols</a></li>
                <li>
                  <a href="/doc-2.3.2/settings.html">Settings</a></li>
                <li>
                  <a href="/doc-2.3.2/ffmpeg.html">FFmpeg support</a></li>
                <li>
                  <a href="/doc-2.3.2/encoding_formats.html">Encoding formats</a></li>
                <li>
                  <a href="/doc-2.3.2/video.html">Videos streams</a></li>
                <li>
                  <a href="/doc-2.3.2/memory.html">Memory management</a></li>
                <li>
                  <a href="/doc-2.3.2/json.html">JSON import/export</a></li>
                <li>
                  <a href="/doc-2.3.2/xml.html">XML import/export</a></li>
                <li>
                  <a href="/doc-2.3.2/yaml.html">YAML import/export</a></li>
                <li>
                  <a href="/doc-2.3.2/ladspa.html">LADSPA plugins</a></li>
                <li>
                  <a href="/doc-2.3.2/playlist_parsers.html">Playlist parsers</a></li>
              </ul>
            </div>
            <div class="bd-toc-item active">
              <a class="bd-toc-link" href="#">
                Core
              </a>
              <ul class="nav bd-sidenav">
                <li>
                  <a href="/doc-2.3.2/sources.html">Sources</a></li>
                <li>
                  <a href="/doc-2.3.2/clocks.html">Clocks</a></li>
                <li>
                  <a href="/doc-2.3.2/requests.html">Requests</a></li>
                <li>
                  <a href="/doc-2.3.2/protocols-presentation.html">Protocols</a></li>
                <li>
                  <a href="/doc-2.3.2/stream_content.html">Stream contents</a></li>
                <li>
                  <a href="/doc-2.3.2/strings_encoding.html">Strings encoding</a></li>
                <li>
                  <a href="/doc-2.3.2/script_loading.html">Script loading</a></li>
                <li><a href="/doc-2.3.2/phases.html">Execution phases</a></li>
              </ul>
            </div>
            <div class="bd-toc-item active">
              <a class="bd-toc-link" href="#">
                Specific tutorials
              </a>
              <ul class="nav bd-sidenav">
                <li>
                  <a href="/doc-2.3.2/harbor_http.html">Using the HTTP server</a></li>
                <li>
                  <a href="/doc-2.3.2/blank.html">Blank detection</a></li>
                <li>
                  <a href="/doc-2.3.2/metadata.html">Customize metadata</a></li>
                <li>
                  <a href="/doc-2.3.2/seek.html">Seek and cue support</a></li>
                <li>
                  <a href="/doc-2.3.2/external_decoders.html">External decoders</a></li>
                <li>
                  <a href="/doc-2.3.2/external_streams.html">External streams</a></li>
                <li>
                  <a href="/doc-2.3.2/external_encoders.html">External encoders</a></li>
                <li>
                  <a href="/doc-2.3.2/hls_output.html">HLS output</a></li>
                <li>
                  <a href="/doc-2.3.2/http_input.html">HTTP input</a></li>
                <li>
                  <a href="/doc-2.3.2/harbor.html">Harbor input</a></li>
                <li>
                  <a href="/doc-2.3.2/stereotool.html">Stereotool</a></li>
                <li>
                  <a href="/doc-2.3.2/server.html">Using the telnet server</a></li>
                <li>
                  <a href="/doc-2.3.2/icy_metadata.html">ICY metadata update</a></li>
                <li>
                  <a href="/doc-2.3.2/replay_gain.html">Normalization and replay gain</a></li>
                <li>
                  <a href="/doc-2.3.2/request_sources.html">Requests-based sources</a></li>
                <li>
                  <a href="/doc-2.3.2/shoutcast.html">Shoutcast output</a></li>
                <li>
                  <a href="/doc-2.3.2/dynamic_sources.html">Dynamic source creation</a></li>
                <li>
                  <a href="/doc-2.3.2/crossfade.html">Crossfading</a></li>
                <li>
                  <a href="/doc-2.3.2/in_production.html">Using in production</a></li>
              </ul>
              <ul class="nav bd-sidenav">
                <li>
                  <a class="bd-toc-link" href="#">
                    User scripts
                  </a>
                </li>
                <li>
                  <a href="/doc-2.3.2/beets.html">Beets</a></li>
                <li>
                  <a href="/doc-2.3.2/geekradio.html">Geekradio</a></li>
                <li>
                  <a href="/doc-2.3.2/radiopi.html">RadioPi</a></li>
                <li>
                  <a href="/doc-2.3.2/dolebrai.html">Dolebraï</a></li>
                <li>
                  <a href="/doc-2.3.2/frequence3.html">Frequence3</a></li>
                <li>
                  <a href="/doc-2.3.2/video-static.html">Video with a single static image</a></li>
                <li>
                  <a href="/doc-2.3.2/split-cue.html">Split a CUE sheet</a></li>
              </ul>
              <ul class="nav bd-sidenav">
                <li>
                  <a class="bd-toc-link" href="#">
                    Behind the curtains
                  </a>
                </li>
                <li>
                  <a href="/doc-2.3.2/publications.html">Some presentations and publications</a></li>
                <li>
                  <a href="https://github.com/savonet">OCaml libraries</a></li>
                <li class="active bd-sidenav-active">
                  <a class="bd-toc-link" href="/legacy">
                    Legacy website
                  </a>
                </li>
              </ul>
            </div>
          </nav>
        </div>
        <!--
          <div class="d-none d-xl-block col-xl-2 bd-toc">
          <ul class="section-nav">
          <li class="toc-entry toc-h2">
          <a href="#quick-start">Quick start</a>
          <ul>
          <li class="toc-entry toc-h3">
          <a href="#css">CSS</a>
          </li>
          <li class="toc-entry toc-h3">
          <a href="#js">JS</a>
          </li>
          <li class="toc-entry toc-h3">
          <a href="#fonts-and-icons">Fonts and Icons</a>
          </li>
          </ul>
          </li>
          <li class="toc-entry toc-h2">
          <a href="#starter-template">Starter template</a>
          </li>
          </ul>
          </div>
        -->
          <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content" role="main">
          <h1 id="clocks"><a href="#clocks"
class="anchor">Clocks</a></h1>
<p>In the <a href="quick_start.html">quickstart</a> and in the
introduction to liquidsoap <a href="sources.html">sources</a>, we have
described a simple world in which sources communicate with each other,
creating and transforming data that composes multimedia streams. In this
simple view, all sources produce data at the same rate, animated by a
single clock: at every cycle of the clock, a fixed amount of data is
produced.</p>
<p>While this simple picture is useful to get a fair idea of what’s
going on in liquidsoap, the full picture is more complex: in fact, a
streaming system might involve <em>multiple clocks</em>, or in other
words several time flows.</p>
<p>It is only in very particular cases that liquidsoap scripts need to
mention clocks explicitly. Otherwise, you won’t even notice how many
clocks are involved in your setup: indeed, liquidsoap can figure out the
clocks by itself, much like it infers types. Nevertheless, there will
sometimes be cases where your script cannot be assigned clocks in a
correct way, in which case liquidsoap will complain. For that reason,
every user should eventually get a minimum understanding of clocks.</p>
<p>In the following, we first describe why we need clocks. Then we go
through the possible errors that any user might encounter regarding
clocks. Finally, we describe how to explicitly use clocks, and show a
few striking examples of what can be achieved that way.</p>
<h2 id="why-multiple-clocks"><a href="#why-multiple-clocks"
class="anchor">Why multiple clocks</a></h2>
<p>The first reason is <strong>external</strong> to liquidsoap: there is
simply not a unique notion of time in the real world. Your computer has
an internal clock which indicates a slightly different time than your
watch or another computer’s clock. Moreover, when communicating with a
remote computer, network latency causes extra time distortions. Even
within a single computer there are several clocks: notably, each
soundcard has its own clock, which will tick at a slightly different
rate than the main clock of the computer. Since liquidsoap communicates
with soundcards and remote computers, it has to take those mismatches
into account.</p>
<p>There are also some reasons that are purely <strong>internal</strong>
to liquidsoap: in order to produce a stream at a given speed, a source
might need to obtain data from another source at a different rate. This
is obvious for an operator that speeds up or slows down audio
(<code>stretch</code>). But it also holds more subtly for
<code>cross</code>, <code>cross</code> as well as the derived operators:
during the lapse of time where the operator combines data from an end of
track with the beginning of the other other, the crossing operator needs
twice as much stream data. After ten tracks, with a crossing duration of
six seconds, one more minute will have passed for the source compared to
the time of the crossing operator.</p>
<p>In order to avoid inconsistencies caused by time differences, while
maintaining a simple and efficient execution model for its sources,
liquidsoap works under the restriction that one source belongs to a
unique clock, fixed once for all when the source is created.</p>
<p>The graph representation of streaming systems can be adapted into a
good representation of what clocks mean. One simply needs to add boxes
representing clocks: a source can belong to only one box, and all
sources of a box produce streams at the same rate. For example,</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">output.icecast</span>(<span class="dt">fallback</span>([<span class="dt">crossfade</span>(<span class="dt">playlist</span>(...)),jingles]))</span></code></pre></div>
<p>yields the following graph:</p>
<figure>
<img src="/assets/img/graph_clocks.png"
alt="Graph representation with clocks" />
<figcaption aria-hidden="true">Graph representation with
clocks</figcaption>
</figure>
<p>Here, clock_2 was created specifically for the crossfading operator;
the rate of that clock is controlled by that operator, which can hence
accelerate it around track changes without any risk of inconsistency.
The other clock is simply a CPU-based clock, so that the main stream is
produced following the ``real’’ time rate.</p>
<h2 id="error-messages"><a href="#error-messages" class="anchor">Error
messages</a></h2>
<p>Most of the time you won’t have to do anything special about clocks:
operators that have special requirements regarding clocks will do what’s
necessary themselves, and liquidsoap will check that everything is fine.
But if the check fails, you’ll need to understand the error, which is
what this section is for.</p>
<h3 id="disjoint-clocks"><a href="#disjoint-clocks"
class="anchor">Disjoint clocks</a></h3>
<p>On the following example, liquidsoap will issue the fatal error
<code>a source cannot belong to two clocks</code>:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="va">s</span> = <span class="dt">playlist</span>(<span class="st">&quot;~/media/audio&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="dt">output.alsa</span>(s) <span class="co"># perhaps for monitoring</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="dt">output.icecast</span>(<span class="va">mount</span>=<span class="st">&quot;radio.ogg&quot;</span>,<span class="ot">%vorbis</span>,<span class="dt">crossfade</span>(s))</span></code></pre></div>
<p>Here, the source <code>s</code> is first assigned the ALSA clock,
because it is tied to an ALSA output. Then, we attempt to build a
<code>crossfade</code> over <code>s</code>. But this operator requires
its source to belong to a dedicated internal clock (because crossfading
requires control over the flow of the of the source, to accelerate it
around track changes). The error expresses this conflict: <code>s</code>
must belong at the same time to the ALSA clock and
<code>crossfade</code>’s clock.</p>
<h3 id="nested-clocks"><a href="#nested-clocks" class="anchor">Nested
clocks</a></h3>
<p>On the following example, liquidsoap will issue the fatal error
<code>cannot unify two nested clocks</code>:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="va">jingles</span> = <span class="dt">playlist</span>(<span class="st">&quot;jingles.lst&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="va">music</span> = <span class="dt">rotate</span>([<span class="dv">1</span>,<span class="dv">10</span>],[jingles,<span class="dt">playlist</span>(<span class="st">&quot;remote.lst&quot;</span>)])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="va">safe</span> = <span class="dt">rotate</span>([<span class="dv">1</span>,<span class="dv">10</span>],[jingles,<span class="dt">single</span>(<span class="st">&quot;local.ogg&quot;</span>)])</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="va">q</span> = <span class="dt">fallback</span>([<span class="dt">crossfade</span>(music),safe])</span></code></pre></div>
<p>Let’s see what happened. The <code>rotate</code> operator, like most
operators, operates within a single clock, which means that
<code>jingles</code> and our two <code>playlist</code> instances must
belong to the same clock. Similarly, <code>music</code> and
<code>safe</code> must belong to that same clock. When we applied
crossfading to <code>music</code>, the <code>crossfade</code> operator
created its own internal clock, call it <code>cross_clock</code>, to
signify that it needs the ability to accelerate at will the streaming of
<code>music</code>. So, <code>music</code> is attached to
<code>cross_clock</code>, and all sources built above come along.
Finally, we build the fallback, which requires that all of its sources
belong to the same clock. In other words, <code>crossfade(music)</code>
must belong to <code>cross_clock</code> just like <code>safe</code>. The
error message simply says that this is forbidden: the internal clock of
our crossfade cannot be its external clock – otherwise it would not have
exclusive control over its internal flow of time.</p>
<p>The same error also occurs on <code>add([crossfade(s),s])</code>, the
simplest example of conflicting time flows, described above. However,
you won’t find yourself writing this obviously problematic piece of
code. On the other hand, one would sometimes like to write things like
our first example.</p>
<p>The key to the error with our first example is that the same
<code>jingles</code> source is used in combination with
<code>music</code> and <code>safe</code>. As a result, liquidsoap sees a
potentially nasty situation, which indeed could be turned into a real
mess by adding just a little more complexity. To obtain the desired
effect without requiring illegal clock assignments, it suffices to
create two jingle sources, one for each clock:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="va">music</span> = <span class="dt">rotate</span>([<span class="dv">1</span>,<span class="dv">10</span>],[<span class="dt">playlist</span>(<span class="st">&quot;jingles.lst&quot;</span>),</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                       <span class="dt">playlist</span>(<span class="st">&quot;remote.lst&quot;</span>)])</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="va">safe</span>  = <span class="dt">rotate</span>([<span class="dv">1</span>,<span class="dv">10</span>],[<span class="dt">playlist</span>(<span class="st">&quot;jingles.lst&quot;</span>),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                       <span class="dt">single</span>(<span class="st">&quot;local.ogg&quot;</span>)])</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="va">q</span> = <span class="dt">fallback</span>([<span class="dt">crossfade</span>(music),safe])</span></code></pre></div>
<p>There is no problem anymore: <code>music</code> belongs to
<code>crossfade</code>’s internal clock, and
<code>crossfade(music)</code>, <code>safe</code> and the
<code>fallback</code> belong to another clock.</p>
<h2 id="the-clock-api"><a href="#the-clock-api" class="anchor">The clock
API</a></h2>
<p>There are only a couple of operations dealing explicitly with
clocks.</p>
<p>The function <code>clock.assign_new(l)</code> creates a new clock and
assigns it to all sources from the list <code>l</code>. For convenience,
we also provide a wrapper, <code>clock(s)</code> which does the same
with a single source instead of a list, and returns that source. With
both functions, the new clock will follow (the computer’s idea of) real
time, unless <code>sync=false</code> is passed, in which case it will
run as fast as possible.</p>
<p>The old (pre-1.0.0) setting <code>root.sync</code> is superseded by
<code>clock.assign_new()</code>. If you want to run an output as fast as
your CPU allows, just attach it to a new clock without
synchronization:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="dt">clock.assign_new</span>(<span class="va">sync</span>=<span class="st">&quot;none&quot;</span>,[source])</span></code></pre></div>
<p>This will automatically attach the appropriate sources to that
clock.</p>
<p>Another important use case of this operator is if your script
involves multiple sources from the same external clock, typically
multiple ALSA input or output from the same sound card or multiple jack
input and output. By default (the so-called <code>clock_safe</code>
mode), liquidsoap will assign a dedicated clock to each of those
sources, leading either to an error or forcing the use of an unnecessary
<code>buffer</code> (see below). Instead, you can allocate each source
with <code>clock_safe=false</code> and assign them a single clock:</p>
<pre><code>s1 = input.jack(clock_safe=false, ...)
s2 = input.jack(clock_safe=false, ...)

clock.assign_new([s1,s2])</code></pre>
<p>However, you may need to do it for other operators if they are
totally unrelated to the first one.</p>
<p>The <code>buffer()</code> operator can be used to communicate between
any two clocks: it takes a source in one clock and builds a source in
another. The trick is that it uses a buffer: if one clock happens to run
too fast or too slow, the buffer may empty or overflow.</p>
<p>Finally, <code>get_clock_status</code> provides information on
existing clocks and track their respective times: it returns a list
containing for each clock a pair <code>(name,time)</code> indicating the
clock id its current time in <em>clock cycles</em> – a cycle corresponds
to the duration of a frame, which is given in ticks, displayed on
startup in the logs. The helper function <code>log_clocks</code> built
around <code>get_clock_status</code> can be used to directly obtain a
simple log file, suitable for graphing with gnuplot. Those functions are
useful to debug latency issues.</p>
<h2 id="external-clocks-decoupling-latencies"><a
href="#external-clocks-decoupling-latencies" class="anchor">External
clocks: decoupling latencies</a></h2>
<p>The first reason to explicitly assign clocks is to precisely handle
the various latencies that might occur in your setup.</p>
<p>Most input/output operators (ALSA, AO, Jack, OSS, etc) require their
own clocks. Indeed, their processing rate is constrained by external
sound APIs or by the hardware itself. Sometimes, it is too much of an
inconvenience, in which case one can set <code>clock_safe=false</code>
to allow another clock assignment – use at your own risk, as this might
create bad latency interferences.</p>
<p>Currently, <code>output.icecast</code> does not require to belong to
any particular clock. This allows to stream according to the soundcard’s
internal clock, like in most other tools: in
<code>output.icecast(%vorbis,mount="live.ogg",input.alsa())</code>, the
ALSA clock will drive the streaming of the soundcard input via
icecast.</p>
<p>Sometimes, the external factors tied to Icecast output cannot be
disregarded: the network may lag. If you stream a soundcard input to
Icecast and the network lags, there will be a glitch in the soundcard
input – a long enough lag will cause a disconnection. This might be
undesirable, and is certainly disappointing if you are recording a
backup of your precious soundcard input using <code>output.file</code>:
by default it will suffer the same latencies and glitches, while in
theory it could be perfect. To fix this you can explicitly separate
Icecast (high latency, low quality acceptable) from the backup and
soundcard input (low latency, high quality wanted):</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="va">input</span> = <span class="dt">input.oss</span>()</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Icecast source, with its own clock:</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="va">icecast_source</span> = <span class="dt">mksafe</span>(<span class="dt">buffer</span>(input))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="dt">clock.assign_new</span>(<span class="va">id</span>=<span class="st">&quot;icecast&quot;</span>, [icecast_source])</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Output to icecast:</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="dt">output.icecast</span>(<span class="ot">%mp3</span>,<span class="va">mount</span>=<span class="st">&quot;blah&quot;</span>,icecast_source)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># File output:</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="dt">output.file</span>(</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="ot">%mp3</span>,{<span class="dt">time.string</span>(<span class="st">&quot;record-%Y-%m-%d-%H-%M-%S.mp3&quot;</span>)},</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  input)</span></code></pre></div>
<p>Here, the soundcard input and file output end up in the OSS clock.
The icecast output goes to the explicitly created <code>"icecast"</code>
clock, and a buffer is used to connect it to the soundcard input. Small
network lags will be absorbed by the buffer. Important lags and possible
disconnections will result in an overflow of the buffer. In any case,
the OSS input and file output won’t be affected by those latencies, and
the recording should be perfect. The Icecast quality is also better with
that setup, since small lags are absorbed by the buffer and do not
create a glitch in the OSS capture, so that Icecast listeners won’t
notice the lag at all.</p>
<h2 id="internal-clocks-exploiting-multiple-cores"><a
href="#internal-clocks-exploiting-multiple-cores"
class="anchor">Internal clocks: exploiting multiple cores</a></h2>
<p>Clocks can also be useful even when external factors are not an
issue. Indeed, several clocks run in several threads, which creates an
opportunity to exploit multiple CPU cores. The story is a bit complex
because OCaml has some limitations on exploiting multiple cores, but in
many situations most of the computing is done in C code (typically
decoding and encoding) so it parallelizes quite well.</p>
<p>Typically, if you run several outputs that do not share much (any)
code, you can put each of them in a separate clock. For example the
following script takes one file and encodes it as MP3 twice. You should
run it as <code>liquidsoap EXPR -- FILE</code> and observe that it fully
exploits two cores:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode liquidsoap"><code class="sourceCode liquidsoap"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="dt">one</span>()</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="va">s</span> = <span class="dt">single</span>(<span class="dt">argv</span>(<span class="dv">1</span>))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clock.assign_new</span>(<span class="va">sync</span>=<span class="st">&quot;none&quot;</span>,[s])</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">output.file</span>(<span class="ot">%mp3</span>,<span class="st">&quot;/dev/null&quot;</span>,s)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="dt">one</span>()</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="dt">one</span>()</span></code></pre></div>
          <div id="footer"></div>
        </main>
      </div>
    </div>
    <!--   Core JS Files   -->

    <script src="/assets/js/core/jquery.min.js" type="text/javascript"></script>
    <script src="/assets/js/core/popper.min.js" type="text/javascript"></script>
    <script src="/assets/js/core/bootstrap-material-design.min.js" type="text/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript"></script>
    <script src="/assets/js/liq-jquery.js" type="text/javascript"></script>
  </body>

</html>
